---
description: 
globs: *.controller.js,*.model.js,*.service.js,*.routes.js,*.middleware.js,src/backend/src/**/*
alwaysApply: false
---
# EDMåç«¯å¼€å‘è§„åˆ™

## ğŸ¯ åç«¯æŠ€æœ¯æ ˆ
- **è¿è¡Œæ—¶**: Node.js 18+
- **æ¡†æ¶**: Express.js
- **æ•°æ®åº“**: PostgreSQL + Sequelize ORM
- **ç¼“å­˜**: Redis
- **è®¤è¯**: JWT + bcrypt
- **é‚®ä»¶æœåŠ¡**: Nodemailer + å¤šæœåŠ¡å•†æ”¯æŒ
- **å®¹å™¨åŒ–**: Docker + Docker Compose

## ğŸ“ åç«¯å®é™…ç›®å½•ç»“æ„
```
src/backend/src/
â”œâ”€â”€ controllers/        # æ§åˆ¶å™¨å±‚ (.controller.js)
â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹ (.model.js)
â”œâ”€â”€ routes/            # è·¯ç”±å®šä¹‰ (.routes.js)
â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘å±‚ (.service.js)
â”‚   â”œâ”€â”€ core/         # æ ¸å¿ƒä¸šåŠ¡æœåŠ¡
â”‚   â””â”€â”€ third-party/  # ç¬¬ä¸‰æ–¹æœåŠ¡é›†æˆ
â”œâ”€â”€ middlewares/       # ä¸­é—´ä»¶ (.middleware.js)
â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•° (.js)
â”œâ”€â”€ config/            # é…ç½®æ–‡ä»¶ (.js)
â””â”€â”€ scripts/           # è„šæœ¬æ–‡ä»¶ (.js)
```

## ğŸ› ï¸ åç«¯å¼€å‘è§„èŒƒ
- **æ–‡ä»¶å‘½å**: 
  - æ§åˆ¶å™¨: `*.controller.js` (å¦‚: `user.controller.js`)
  - æ¨¡å‹: `*.model.js` (å¦‚: `user.model.js`)
  - æœåŠ¡: `*.service.js` (å¦‚: `user.service.js`)
  - è·¯ç”±: `*.routes.js` (å¦‚: `user.routes.js`)
  - ä¸­é—´ä»¶: `*.middleware.js` (å¦‚: `auth.middleware.js`)
- **APIè·¯å¾„**: RESTfulé£æ ¼ (`/api/v1/users`)
- **é”™è¯¯å¤„ç†**: ç»Ÿä¸€é”™è¯¯å¤„ç†ä¸­é—´ä»¶
- **æ•°æ®éªŒè¯**: ä½¿ç”¨Joiæˆ–express-validator
- **æ—¥å¿—è®°å½•**: ä½¿ç”¨winstonï¼Œç»“æ„åŒ–æ—¥å¿—
- **å¼‚æ­¥å¤„ç†**: ä½¿ç”¨async/awaitï¼Œé¿å…å›è°ƒåœ°ç‹±

## ğŸ—ƒï¸ æ•°æ®åº“è§„èŒƒ
- **è¡¨å‘½å**: å¤æ•°å½¢å¼ï¼Œsnake_case (å¦‚: `email_campaigns`)
- **å­—æ®µå‘½å**: snake_case (å¦‚: `created_at`)
- **ä¸»é”®**: ç»Ÿä¸€ä½¿ç”¨`id`ï¼Œè‡ªå¢æ•´æ•°
- **æ—¶é—´æˆ³**: å¿…é¡»æœ‰`created_at`å’Œ`updated_at`
- **è½¯åˆ é™¤**: ä½¿ç”¨`deleted_at`å­—æ®µ
- **ç´¢å¼•**: æŸ¥è¯¢é¢‘ç¹çš„å­—æ®µå¿…é¡»æœ‰ç´¢å¼•

## ğŸ”Œ APIè®¾è®¡è§„èŒƒ
```javascript
// æ ‡å‡†æ§åˆ¶å™¨ç»“æ„ (*.controller.js)
const controllerName = {
  // GET /api/v1/resource
  async list(req, res, next) {
    try {
      const result = await Service.list(req.query);
      res.json(result);
    } catch (error) {
      next(error);
    }
  },
  
  // POST /api/v1/resource
  async create(req, res, next) {
    try {
      const result = await Service.create(req.body);
      res.status(201).json(result);
    } catch (error) {
      next(error);
    }
  }
};

module.exports = controllerName;
```

## ğŸ“Š æ•°æ®æ¨¡å‹ç¤ºä¾‹
```javascript
// Sequelizeæ¨¡å‹å®šä¹‰ (*.model.js)
const { DataTypes } = require('sequelize');

const Model = (sequelize) => {
  return sequelize.define('ModelName', {
    id: {
      type: DataTypes.INTEGER,
      primaryKey: true,
      autoIncrement: true
    },
    name: {
      type: DataTypes.STRING,
      allowNull: false,
      validate: {
        notEmpty: true,
        len: [1, 255]
      }
    },
    status: {
      type: DataTypes.ENUM('active', 'inactive'),
      defaultValue: 'active'
    }
  }, {
    tableName: 'model_names',
    timestamps: true,
    paranoid: true // è½¯åˆ é™¤
  });
};

module.exports = Model;
```

## ğŸ” å®‰å…¨è§„èŒƒ
- **è¾“å…¥éªŒè¯**: æ‰€æœ‰ç”¨æˆ·è¾“å…¥å¿…é¡»éªŒè¯å’Œè¿‡æ»¤
- **SQLæ³¨å…¥**: ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œç¦æ­¢å­—ç¬¦ä¸²æ‹¼æ¥
- **XSSé˜²æŠ¤**: è¾“å‡ºè½¬ä¹‰ï¼ŒContent-Security-Policy
- **è®¤è¯æˆæƒ**: JWT TokenéªŒè¯ï¼Œæƒé™æ§åˆ¶
- **æ•æ„Ÿä¿¡æ¯**: ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œç¦æ­¢ç¡¬ç¼–ç 
- **æ—¥å¿—å®‰å…¨**: ä¸è®°å½•æ•æ„Ÿä¿¡æ¯

## ğŸ“‹ åç«¯æ£€æŸ¥æ¸…å•
- [ ] APIéµå¾ªRESTfulè§„èŒƒ
- [ ] æ•°æ®éªŒè¯å’Œé”™è¯¯å¤„ç†
- [ ] æ•°æ®åº“äº‹åŠ¡å¤„ç†
- [ ] è®¤è¯å’Œæƒé™æ§åˆ¶
- [ ] æ—¥å¿—è®°å½•å’Œç›‘æ§
- [ ] å•å…ƒæµ‹è¯•è¦†ç›–
- [ ] APIæ–‡æ¡£æ›´æ–°

## ğŸš€ åç«¯å‘½ä»¤
```bash
cd src/backend
npm run dev             # å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run test            # è¿è¡Œæµ‹è¯•
npm run migrate         # æ•°æ®åº“è¿ç§»
npm run seed            # æ•°æ®åº“ç§å­æ•°æ®
npm run lint            # ä»£ç æ£€æŸ¥
```

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥
- **æ•°æ®åº“è¿æ¥å¤±è´¥**: æ£€æŸ¥`config/config.js`å’Œç¯å¢ƒå˜é‡
- **Redisè¿æ¥å¤±è´¥**: ç¡®è®¤RedisæœåŠ¡çŠ¶æ€å’Œé…ç½®
- **é‚®ä»¶å‘é€å¤±è´¥**: æ£€æŸ¥é‚®ä»¶æœåŠ¡é…ç½®å’Œç½‘ç»œè¿æ¥
- **JWT Tokenå¤±æ•ˆ**: æ£€æŸ¥Tokenç”Ÿæˆå’ŒéªŒè¯é€»è¾‘
- **APIå“åº”æ…¢**: æ£€æŸ¥æ•°æ®åº“æŸ¥è¯¢å’Œç´¢å¼•ä¼˜åŒ–

## ğŸ“‚ å®é™…æ–‡ä»¶ç¤ºä¾‹
- **æ§åˆ¶å™¨**: `controllers/user.controller.js`
- **æ¨¡å‹**: `models/user.model.js`
- **æœåŠ¡**: `services/core/contact.service.js`
- **è·¯ç”±**: `routes/auth.routes.js`
- **ä¸­é—´ä»¶**: `middlewares/auth.middleware.js`
- **å·¥å…·**: `utils/appError.js`
- **é…ç½®**: `config/config.js`
