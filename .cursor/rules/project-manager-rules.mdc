---
description: 
globs: 
alwaysApply: true
---

## å‰ç«¯é…ç½®ç®¡ç†è§„èŒƒï¼š
 - æ‰€æœ‰ç¯å¢ƒç›¸å…³é…ç½®å¿…é¡»ä»é…ç½®æ–‡ä»¶æˆ–ç¯å¢ƒå˜é‡è·å–
 - ç¦æ­¢åœ¨ä¸šåŠ¡ä»£ç ä¸­ç¡¬ç¼–ç ç¯å¢ƒå‚æ•°
 - æä¾›ç¯å¢ƒæ£€æµ‹æœºåˆ¶è‡ªåŠ¨åˆ‡æ¢é…ç½®

## APIè°ƒç”¨è§„èŒƒï¼š
 - ç»Ÿä¸€ä½¿ç”¨APIæœåŠ¡å±‚å¤„ç†è¯·æ±‚
 - æ‰€æœ‰APIè·¯å¾„å¿…é¡»ä»é…ç½®ä¸­å¿ƒè·å–
 - æä¾›APIå¥åº·æ£€æŸ¥æœºåˆ¶

## è®¤è¯ä¸å®‰å…¨è§„èŒƒï¼š
 - ç»Ÿä¸€JWTç”Ÿæˆä¸éªŒè¯æ ‡å‡†
 - æ˜ç¡®å¯†ç è¦æ±‚å¹¶åœ¨æ–‡æ¡£ä¸­ä¿æŒä¸€è‡´
 - æ¨¡æ‹Ÿæ•°æ®å¿…é¡»ç¬¦åˆçœŸå®æ•°æ®æ ¼å¼

## æµ‹è¯•ä¸æ–‡æ¡£è§„èŒƒï¼š
 - å¿…é¡»åŒ…å«ç¯å¢ƒåˆ‡æ¢æµ‹è¯•
 - ä¸ºæ‰€æœ‰é…ç½®é¡¹æä¾›æ˜ç¡®æ–‡æ¡£
 - ä½¿ç”¨è‡ªåŠ¨åŒ–æµ‹è¯•éªŒè¯é…ç½®æ­£ç¡®æ€§

## æ„å»ºæµç¨‹æ”¹è¿›ï¼š
 - ä½¿ç”¨ç¯å¢ƒæ›¿æ¢åŠŸèƒ½åœ¨æ„å»ºæ—¶æ³¨å…¥æ­£ç¡®é…ç½®
 - æ„å»ºåè‡ªåŠ¨éªŒè¯é…ç½®ä¸€è‡´æ€§
 - é¢„å‘å¸ƒç¯å¢ƒæ¨¡æ‹Ÿç”Ÿäº§é…ç½®è¿›è¡Œæµ‹è¯•



**å‰ç«¯å¼€å‘è§„èŒƒ**

### Phase 1: æ¥å£è®¾è®¡é˜¶æ®µ
1. **åç«¯å…ˆè¡Œ**: å…ˆç¡®å®šæ•°æ®æ¨¡å‹å’ŒAPIç«¯ç‚¹
2. **ç”Ÿæˆç±»å‹å®šä¹‰**: æ ¹æ®åç«¯æ¨¡å‹ç”ŸæˆTypeScriptç±»å‹
3. **å‰ç«¯ç¡®è®¤**: å‰ç«¯ç¡®è®¤ç±»å‹å®šä¹‰æ— è¯¯

### Phase 2: å¼€å‘é˜¶æ®µ
1. **ç±»å‹å¯¼å…¥**: å‰ç«¯åªä» `types/api.ts` å¯¼å…¥ç±»å‹
2. **Serviceå®ç°**: æ¯ä¸ªæ–¹æ³•å¿…é¡»å¯¹åº”æ˜ç¡®çš„APIç«¯ç‚¹
3. **å‘åå…¼å®¹**: æ–°æ–¹æ³•æä¾›æ—§æ–¹æ³•çš„åˆ«å

### Phase 3: æµ‹è¯•é˜¶æ®µ
1. **ç¼–è¯‘æ£€æŸ¥**: ç¡®ä¿TypeScriptç¼–è¯‘æ— é”™è¯¯
2. **é›†æˆæµ‹è¯•**: éªŒè¯å‰åç«¯æ¥å£è”è°ƒ
3. **ç±»å‹æ£€æŸ¥**: ä½¿ç”¨å·¥å…·éªŒè¯ç±»å‹ä¸€è‡´æ€§



## ğŸš« ç¦æ­¢çš„åšæ³•

### âŒ ç›´æ¥åœ¨ç»„ä»¶ä¸­å®šä¹‰ç±»å‹
```typescript
// é”™è¯¯: ç»„ä»¶å†…å®šä¹‰ç±»å‹
const ConversationDetail = () => {
  interface Message { body: string }  // âŒ
}
```

### âŒ ç¡¬ç¼–ç å­—æ®µå
```typescript
// é”™è¯¯: ç¡¬ç¼–ç è®¿é—®ä¸å­˜åœ¨çš„å­—æ®µ
message.body              // âŒ åº”ä½¿ç”¨ content_text
message.html_body         // âŒ åº”ä½¿ç”¨ content_html
message.is_read          // âŒ åº”ä½¿ç”¨ status === 'read'
```

### âŒ æ–¹æ³•åä¸å¯¹åº”API
```typescript
// é”™è¯¯: æ–¹æ³•åä¸APIä¸å¯¹åº”
getConversationById()     // âŒ APIæ˜¯ /conversations/:id
sendMessage()            // âŒ APIæ˜¯ /conversations/:id/reply
```

## âœ… æ¨èçš„åšæ³•

### âœ… é›†ä¸­ç±»å‹ç®¡ç†
```typescript
// src/types/api.ts - ç»Ÿä¸€ç±»å‹å®šä¹‰
export interface ConversationMessage {
  content_text?: string;
  content_html?: string;
  status: MessageStatus;
}
```

### âœ… æ¸…æ™°çš„APIæ˜ å°„
```typescript
class ConversationService {
  // æ¯ä¸ªæ–¹æ³•éƒ½æœ‰æ¸…æ™°çš„APIæ–‡æ¡£
  /**
   * è·å–ä¼šè¯åˆ—è¡¨
   * @api GET /api/conversations
   * @param params æŸ¥è¯¢å‚æ•°
   * @returns ä¼šè¯åˆ—è¡¨å“åº”
   */
  async getConversations(params?: ConversationListParams) {
    // å®ç°
  }
}
```

### âœ… å‘åå…¼å®¹ç­–ç•¥
```typescript
// æä¾›åˆ«åæ–¹æ³•ä¿æŒå‘åå…¼å®¹
async getConversationById(id: string) {
  return this.getConversationDetail(id);
}

// å¯¼å‡ºç±»å‹åˆ«å
export type EmailMessage = ConversationMessage;
```


