# APIæµ‹è¯•è§„èŒƒæ–‡æ¡£

## ğŸ¯ ç›®çš„
é¿å…APIå­—æ®µåä¸ä¸€è‡´å¯¼è‡´çš„æµ‹è¯•å¤±è´¥ï¼Œå»ºç«‹ç»Ÿä¸€çš„APIæµ‹è¯•æ ‡å‡†ã€‚

## ğŸ“‹ æ ¸å¿ƒAPIå­—æ®µè§„èŒƒ

### 1. è®¤è¯API (`/api/auth`)

#### ç™»å½•API
- **è·¯å¾„**: `POST /api/auth/login`
- **å¿…éœ€å­—æ®µ**: 
  - `usernameOrEmail` (ä¸æ˜¯ `username` æˆ– `email`)
  - `password`
- **ç¤ºä¾‹**:
```json
{
  "usernameOrEmail": "admin",
  "password": "admin123"
}
```

#### æ³¨å†ŒAPI
- **è·¯å¾„**: `POST /api/auth/register`
- **å¿…éœ€å­—æ®µ**:
  - `username`
  - `email`
  - `password`
  - `role` (å¯é€‰: admin, operator, read_only)

### 2. ç”¨æˆ·ç®¡ç†API (`/api/users`)

#### ç”¨æˆ·é¢åº¦åˆ†é…
- **è·¯å¾„**: `POST /api/users/:id/quota`
- **å¿…éœ€å­—æ®µ**:
  - `amount` (æ­£æ•´æ•°)
  - `reason` (å¯é€‰å­—ç¬¦ä¸²)
- **æƒé™**: ä»…ç®¡ç†å‘˜
- **ç¤ºä¾‹**:
```json
{
  "amount": 1000,
  "reason": "åˆå§‹é¢åº¦åˆ†é…"
}
```

#### è·å–ç”¨æˆ·é¢åº¦
- **è·¯å¾„**: `GET /api/users/:id/quota`
- **æƒé™**: ä»…ç®¡ç†å‘˜

### 3. å‘ä¿¡æœåŠ¡API (`/api/email-services`)

#### åˆ›å»ºå‘ä¿¡æœåŠ¡
- **è·¯å¾„**: `POST /api/email-services`
- **å¿…éœ€å­—æ®µ**:
  - `name` (å”¯ä¸€)
  - `provider` (å¦‚: smtp, engagelab)
  - `api_key`
  - `api_secret`
  - `domain` (å”¯ä¸€)
- **å¯é€‰å­—æ®µ**:
  - `daily_quota` (é»˜è®¤: 1000)
  - `sending_rate` (é»˜è®¤: 60)
- **æƒé™**: ä»…ç®¡ç†å‘˜

### 4. ä»»åŠ¡ç®¡ç†API (`/api/tasks`)

#### ä»»åŠ¡è¡¨å­—æ®µæ˜ å°„
- **å®é™…å­—æ®µ**: `template_set_id` (ä¸æ˜¯ `template_id`)
- **å®é™…å­—æ®µ**: `sender_id` (å¿…éœ€)
- **å®é™…å­—æ®µ**: `created_by` (ç”¨æˆ·ID)
- **å®é™…å­—æ®µ**: `schedule_time` (ä¸æ˜¯ `scheduled_at`)

### 5. å­ä»»åŠ¡è¡¨å­—æ®µè¦æ±‚
- **å¿…éœ€å­—æ®µ**:
  - `sender_email` (å‘ä¿¡äººé‚®ç®±)
  - `recipient_email` (æ”¶ä»¶äººé‚®ç®±)
  - `template_id` (æ¨¡æ¿ID)
  - `rendered_subject` (æ¸²æŸ“åä¸»é¢˜)
  - `rendered_body` (æ¸²æŸ“åå†…å®¹)
  - `tracking_id` (è·Ÿè¸ªID)

## ğŸ”§ æµ‹è¯•è„šæœ¬è§„èŒƒ

### 1. ç¯å¢ƒå˜é‡è®¾ç½®
```bash
# è·å–è®¤è¯Token
TOKEN=$(curl -s -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"usernameOrEmail": "admin", "password": "admin123"}' | \
  jq -r '.token')
```

### 2. é”™è¯¯å¤„ç†è§„èŒƒ
- æ¯ä¸ªAPIè°ƒç”¨åæ£€æŸ¥è¿”å›çŠ¶æ€
- è®°å½•å¤±è´¥åŸå› å’Œæ­£ç¡®çš„å­—æ®µå
- æä¾›ä¿®å¤å»ºè®®

### 3. æ•°æ®åº“æ“ä½œè§„èŒƒ
- ä»…åœ¨APIæ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ä½¿ç”¨ç›´æ¥æ•°æ®åº“æ“ä½œ
- è®°å½•æ‰€æœ‰æ•°æ®åº“æ“ä½œçš„åŸå› 
- æ ‡è®°ä¸º"æ¨¡æ‹Ÿæ•°æ®"

## ğŸ“Š å¸¸è§é”™è¯¯åŠè§£å†³æ–¹æ¡ˆ

### é”™è¯¯1: ç™»å½•å­—æ®µé”™è¯¯
- **é”™è¯¯**: ä½¿ç”¨ `username` æˆ– `email`
- **æ­£ç¡®**: ä½¿ç”¨ `usernameOrEmail`

### é”™è¯¯2: å‘ä¿¡æœåŠ¡å­—æ®µé”™è¯¯
- **é”™è¯¯**: ä½¿ç”¨ `type`, `host`, `port`
- **æ­£ç¡®**: ä½¿ç”¨ `provider`, `api_key`, `api_secret`, `domain`

### é”™è¯¯3: ä»»åŠ¡å­—æ®µé”™è¯¯
- **é”™è¯¯**: ä½¿ç”¨ `template_id`
- **æ­£ç¡®**: ä½¿ç”¨ `template_set_id`

## ğŸš¨ å¼ºåˆ¶æ‰§è¡Œè§„åˆ™

1. **æµ‹è¯•å‰å¿…è¯»**: æ¯æ¬¡æµ‹è¯•å‰å¿…é¡»æŸ¥é˜…æ­¤è§„èŒƒ
2. **å­—æ®µéªŒè¯**: ä½¿ç”¨APIå‰å…ˆéªŒè¯å­—æ®µå
3. **é”™è¯¯è®°å½•**: å‘ç°æ–°çš„å­—æ®µä¸ä¸€è‡´ç«‹å³æ›´æ–°æ­¤æ–‡æ¡£
4. **ä»£ç å®¡æŸ¥**: æ‰€æœ‰æµ‹è¯•è„šæœ¬å¿…é¡»ç¬¦åˆæ­¤è§„èŒƒ

## ğŸ“ æ›´æ–°æ—¥å¿—

- 2025-06-10: åˆå§‹ç‰ˆæœ¬ï¼Œè®°å½•ç™»å½•ã€ç”¨æˆ·é¢åº¦ã€å‘ä¿¡æœåŠ¡APIè§„èŒƒ
- å¾…æ›´æ–°: æ¨¡æ¿ã€è”ç³»äººã€ä»»åŠ¡ç­‰å…¶ä»–APIè§„èŒƒ

---

**é‡è¦æé†’**: æ­¤æ–‡æ¡£æ˜¯é¿å…é‡å¤é”™è¯¯çš„å…³é”®ï¼Œæ¯æ¬¡APIæµ‹è¯•éƒ½å¿…é¡»å‚è€ƒï¼ 