# å¤šçº§æ ‡ç­¾ç³»ç»Ÿæµ‹è¯•ç”¨ä¾‹

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬æ–‡æ¡£åŒ…å«å¤šçº§æ ‡ç­¾ç³»ç»Ÿçš„å®Œæ•´æµ‹è¯•ç”¨ä¾‹ï¼Œæ¶µç›–å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œä¸šåŠ¡æµ‹è¯•ã€‚

## ğŸ§ª æµ‹è¯•ç¯å¢ƒ

- **åç«¯**: Dockerå®¹å™¨ (localhost:3000)
- **æ•°æ®åº“**: PostgreSQL (Docker)
- **è®¤è¯**: æ°¸ä¹…Token: `dev-permanent-test-token-admin-2025`
- **æµ‹è¯•å·¥å…·**: curl + jq

## ğŸ“ æµ‹è¯•æ•°æ®å‡†å¤‡

### 1. åŸºç¡€æ ‡ç­¾æ•°æ®
```bash
# çˆ¶æ ‡ç­¾ï¼šå®¢æˆ·åˆ†ç±»
PARENT_TAG_ID="84e15792-8128-43ac-9fd6-9fac1c7bb13d"

# å­æ ‡ç­¾ï¼šVIPå®¢æˆ·
CHILD_TAG_VIP="ad4cfae2-2cb0-4f69-824f-1e7194a5ca09"

# å­æ ‡ç­¾ï¼šæ™®é€šå®¢æˆ·  
CHILD_TAG_NORMAL="a132d7ca-3bc9-49e9-aeb4-fc115b74d56c"
```

### 2. æµ‹è¯•è”ç³»äººæ•°æ®
```bash
# è·å–ç°æœ‰è”ç³»äººIDç”¨äºæµ‹è¯•
CONTACT_ID=$(curl -s -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/contacts?limit=1" | jq -r '.data[0].id')
```

## ğŸ”¬ å•å…ƒæµ‹è¯•

### æµ‹è¯•1: æ ‡ç­¾CRUDæ“ä½œ

#### 1.1 åˆ›å»ºçˆ¶æ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•1.1: åˆ›å»ºçˆ¶æ ‡ç­¾"
curl -X POST -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"name":"æµ‹è¯•å®¢æˆ·åˆ†ç±»","description":"æµ‹è¯•ç”¨çˆ¶æ ‡ç­¾"}' \
  "http://localhost:3000/api/tags" | jq '.success'
```

#### 1.2 åˆ›å»ºå­æ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•1.2: åˆ›å»ºå­æ ‡ç­¾"
curl -X POST -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"name":"æµ‹è¯•VIP","description":"æµ‹è¯•ç”¨å­æ ‡ç­¾","parentId":"'$PARENT_TAG_ID'"}' \
  "http://localhost:3000/api/tags" | jq '.success'
```

#### 1.3 è·å–æ ‡ç­¾æ ‘
```bash
echo "ğŸ§ª æµ‹è¯•1.3: è·å–æ ‡ç­¾æ ‘"
curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/tree" | jq '.data | length'
```

#### 1.4 æ›´æ–°æ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•1.4: æ›´æ–°æ ‡ç­¾"
curl -X PUT -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"name":"æ›´æ–°åçš„VIPå®¢æˆ·","description":"æ›´æ–°åçš„æè¿°"}' \
  "http://localhost:3000/api/tags/'$CHILD_TAG_VIP'" | jq '.success'
```

### æµ‹è¯•2: å±‚çº§å…³ç³»éªŒè¯

#### 2.1 é˜²æ­¢å¾ªç¯å¼•ç”¨
```bash
echo "ğŸ§ª æµ‹è¯•2.1: é˜²æ­¢å¾ªç¯å¼•ç”¨"
curl -X PUT -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"parentId":"'$CHILD_TAG_VIP'"}' \
  "http://localhost:3000/api/tags/'$PARENT_TAG_ID'" | jq '.success'
# é¢„æœŸç»“æœ: false (åº”è¯¥è¢«æ‹’ç»)
```

#### 2.2 ç§»åŠ¨æ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•2.2: ç§»åŠ¨æ ‡ç­¾"
curl -X PUT -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"parentId":null}' \
  "http://localhost:3000/api/tags/'$CHILD_TAG_VIP'/move" | jq '.success'
```

## ğŸ”— é›†æˆæµ‹è¯•

### æµ‹è¯•3: è”ç³»äººæ ‡ç­¾å…³è”

#### 3.1 å…³è”å­æ ‡ç­¾ï¼ˆè‡ªåŠ¨ç»§æ‰¿çˆ¶æ ‡ç­¾ï¼‰
```bash
echo "ğŸ§ª æµ‹è¯•3.1: å…³è”å­æ ‡ç­¾ï¼ˆè‡ªåŠ¨ç»§æ‰¿ï¼‰"
curl -X POST -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"autoInherit":true}' \
  "http://localhost:3000/api/tags/'$CHILD_TAG_VIP'/contacts/'$CONTACT_ID'" | jq '.data.addedTags'
```

#### 3.2 éªŒè¯è”ç³»äººæ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•3.2: éªŒè¯è”ç³»äººæ ‡ç­¾"
curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/contacts/'$CONTACT_ID'/tags" | jq '.data | {directTags: .directTags | length, inheritedTags: .inheritedTags | length}'
```

#### 3.3 éªŒè¯æ ‡ç­¾è”ç³»äººç»Ÿè®¡
```bash
echo "ğŸ§ª æµ‹è¯•3.3: éªŒè¯æ ‡ç­¾è”ç³»äººç»Ÿè®¡"
curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/'$PARENT_TAG_ID'" | jq '.data.contact_count'

curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/'$CHILD_TAG_VIP'" | jq '.data.contact_count'
```

### æµ‹è¯•4: æ™ºèƒ½åˆ é™¤é€»è¾‘

#### 4.1 åˆ é™¤å­æ ‡ç­¾ï¼ˆä¿ç•™çˆ¶æ ‡ç­¾ï¼‰
```bash
echo "ğŸ§ª æµ‹è¯•4.1: åˆ é™¤å­æ ‡ç­¾"
curl -X DELETE -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/'$CHILD_TAG_VIP'/contacts/'$CONTACT_ID'" | jq '.data.removedTags'
```

#### 4.2 éªŒè¯çˆ¶æ ‡ç­¾æ˜¯å¦ä¿ç•™
```bash
echo "ğŸ§ª æµ‹è¯•4.2: éªŒè¯çˆ¶æ ‡ç­¾ä¿ç•™"
curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/contacts/'$CONTACT_ID'/tags" | jq '.data.allTags | map(select(.id == "'$PARENT_TAG_ID'")) | length'
```

### æµ‹è¯•5: æ‰¹é‡æ“ä½œ

#### 5.1 æ‰¹é‡æ·»åŠ æ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•5.1: æ‰¹é‡æ·»åŠ æ ‡ç­¾"
# è·å–å¤šä¸ªè”ç³»äººID
CONTACT_IDS=$(curl -s -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/contacts?limit=3" | jq -r '.data | map(.id) | @json')

curl -X POST -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"contactIds":'$CONTACT_IDS',"tagIds":["'$PARENT_TAG_ID'"]}' \
  "http://localhost:3000/api/tags/bulk-add" | jq '.data.updatedContactCount'
```

#### 5.2 æ‰¹é‡ç§»é™¤æ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•5.2: æ‰¹é‡ç§»é™¤æ ‡ç­¾"
curl -X POST -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"contactIds":'$CONTACT_IDS',"tagIds":["'$PARENT_TAG_ID'"]}' \
  "http://localhost:3000/api/tags/bulk-remove" | jq '.data.updatedContactCount'
```

## ğŸ² ä¸šåŠ¡æµ‹è¯•

### æµ‹è¯•6: A/Bæµ‹è¯•åˆ†ç»„

#### 6.1 å‡†å¤‡æµ‹è¯•æ•°æ®
```bash
echo "ğŸ§ª æµ‹è¯•6.1: å‡†å¤‡A/Bæµ‹è¯•æ•°æ®"
# ä¸ºçˆ¶æ ‡ç­¾æ·»åŠ å¤šä¸ªè”ç³»äºº
curl -X POST -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"contactIds":'$CONTACT_IDS',"tagIds":["'$PARENT_TAG_ID'"]}' \
  "http://localhost:3000/api/tags/bulk-add"
```

#### 6.2 åˆ›å»ºA/Bæµ‹è¯•åˆ†ç»„
```bash
echo "ğŸ§ª æµ‹è¯•6.2: åˆ›å»ºA/Bæµ‹è¯•åˆ†ç»„"
curl -X POST -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{
    "testName": "é‚®ä»¶æ•ˆæœæµ‹è¯•",
    "groupCount": 2,
    "splitRatio": [0.6, 0.4],
    "groupNames": ["å®éªŒç»„", "å¯¹ç…§ç»„"]
  }' \
  "http://localhost:3000/api/tags/'$PARENT_TAG_ID'/split-test" | jq '.data.summary'
```

#### 6.3 éªŒè¯åˆ†ç»„ç»“æœ
```bash
echo "ğŸ§ª æµ‹è¯•6.3: éªŒè¯åˆ†ç»„ç»“æœ"
curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/tree" | jq '.data[] | select(.name == "å®¢æˆ·åˆ†ç±»") | .children | map(select(.name | contains("é‚®ä»¶æ•ˆæœæµ‹è¯•"))) | length'
```

### æµ‹è¯•7: æ ‡ç­¾åˆ é™¤ä¿æŠ¤

#### 7.1 å°è¯•åˆ é™¤æœ‰å­æ ‡ç­¾çš„çˆ¶æ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•7.1: åˆ é™¤æœ‰å­æ ‡ç­¾çš„çˆ¶æ ‡ç­¾ï¼ˆåº”è¯¥å¤±è´¥ï¼‰"
curl -X DELETE -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/'$PARENT_TAG_ID'" | jq '.success'
# é¢„æœŸç»“æœ: false
```

#### 7.2 å°è¯•åˆ é™¤æœ‰è”ç³»äººçš„æ ‡ç­¾
```bash
echo "ğŸ§ª æµ‹è¯•7.2: åˆ é™¤æœ‰è”ç³»äººçš„æ ‡ç­¾ï¼ˆåº”è¯¥å¤±è´¥ï¼‰"
curl -X DELETE -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/'$CHILD_TAG_VIP'" | jq '.success'
# é¢„æœŸç»“æœ: false
```

## ğŸ“Š æ€§èƒ½æµ‹è¯•

### æµ‹è¯•8: å¤§é‡æ•°æ®æ€§èƒ½

#### 8.1 æŸ¥è¯¢æ€§èƒ½æµ‹è¯•
```bash
echo "ğŸ§ª æµ‹è¯•8.1: æŸ¥è¯¢æ€§èƒ½æµ‹è¯•"
time curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/tree" > /dev/null
```

#### 8.2 æ‰¹é‡æ“ä½œæ€§èƒ½
```bash
echo "ğŸ§ª æµ‹è¯•8.2: æ‰¹é‡æ“ä½œæ€§èƒ½"
# è·å–å¤§é‡è”ç³»äººID
LARGE_CONTACT_IDS=$(curl -s -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/contacts?limit=50" | jq -r '.data | map(.id) | @json')

time curl -X POST -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  -H "Content-Type: application/json" \
  -d '{"contactIds":'$LARGE_CONTACT_IDS',"tagIds":["'$PARENT_TAG_ID'"]}' \
  "http://localhost:3000/api/tags/bulk-add" > /dev/null
```

## ğŸ” æ•°æ®ä¸€è‡´æ€§æµ‹è¯•

### æµ‹è¯•9: JSONBåŒå‘åŒæ­¥éªŒè¯

#### 9.1 éªŒè¯è”ç³»äººtagså­—æ®µ
```bash
echo "ğŸ§ª æµ‹è¯•9.1: éªŒè¯è”ç³»äººtagså­—æ®µ"
curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/contacts/'$CONTACT_ID'" | jq '.data.tags'
```

#### 9.2 éªŒè¯æ ‡ç­¾contactså­—æ®µ
```bash
echo "ğŸ§ª æµ‹è¯•9.2: éªŒè¯æ ‡ç­¾contactså­—æ®µ"
curl -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/'$PARENT_TAG_ID'/contacts" | jq '.data.contacts | length'
```

#### 9.3 äº¤å‰éªŒè¯æ•°æ®ä¸€è‡´æ€§
```bash
echo "ğŸ§ª æµ‹è¯•9.3: äº¤å‰éªŒè¯æ•°æ®ä¸€è‡´æ€§"
# ä»è”ç³»äººè§’åº¦æŸ¥çœ‹æ ‡ç­¾
CONTACT_TAGS=$(curl -s -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/contacts/'$CONTACT_ID'" | jq -r '.data.tags[]')

# ä»æ ‡ç­¾è§’åº¦æŸ¥çœ‹è”ç³»äºº
TAG_CONTACTS=$(curl -s -H "Authorization: Bearer dev-permanent-test-token-admin-2025" \
  "http://localhost:3000/api/tags/'$PARENT_TAG_ID'/contacts" | jq -r '.data.contacts[].id')

echo "è”ç³»äººçš„æ ‡ç­¾: $CONTACT_TAGS"
echo "æ ‡ç­¾çš„è”ç³»äºº: $TAG_CONTACTS"
```

## âœ… æµ‹è¯•ç»“æœéªŒè¯

### é¢„æœŸç»“æœ
1. **æ ‡ç­¾CRUD**: æ‰€æœ‰æ“ä½œæˆåŠŸï¼Œè¿”å›æ­£ç¡®æ•°æ®ç»“æ„
2. **å±‚çº§å…³ç³»**: æ­£ç¡®å»ºç«‹çˆ¶å­å…³ç³»ï¼Œé˜²æ­¢å¾ªç¯å¼•ç”¨
3. **è‡ªåŠ¨ç»§æ‰¿**: å…³è”å­æ ‡ç­¾æ—¶è‡ªåŠ¨å…³è”çˆ¶æ ‡ç­¾
4. **æ™ºèƒ½åˆ é™¤**: åˆ é™¤å­æ ‡ç­¾æ—¶æ™ºèƒ½å¤„ç†çˆ¶æ ‡ç­¾
5. **æ‰¹é‡æ“ä½œ**: é«˜æ•ˆå¤„ç†å¤šä¸ªè”ç³»äºº/æ ‡ç­¾
6. **A/Bæµ‹è¯•**: æ­£ç¡®éšæœºåˆ†ç»„ï¼Œåˆ›å»ºåˆ†ç»„æ ‡ç­¾
7. **åˆ é™¤ä¿æŠ¤**: æœ‰å…³è”æ—¶æ‹’ç»åˆ é™¤
8. **æ€§èƒ½**: æŸ¥è¯¢å’Œæ‰¹é‡æ“ä½œåœ¨å¯æ¥å—èŒƒå›´å†…
9. **æ•°æ®ä¸€è‡´æ€§**: JSONBåŒå‘åŒæ­¥æ­£ç¡®

### å¤±è´¥å¤„ç†
- è®°å½•å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹
- åˆ†æå¤±è´¥åŸå› 
- ä¿®å¤ä»£ç åé‡æ–°æµ‹è¯•
- æ›´æ–°æµ‹è¯•ç”¨ä¾‹

## ğŸš€ è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# å¤šçº§æ ‡ç­¾ç³»ç»Ÿè‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬

set -e

echo "ğŸš€ å¼€å§‹å¤šçº§æ ‡ç­¾ç³»ç»Ÿæµ‹è¯•..."

# è®¾ç½®å˜é‡
BASE_URL="http://localhost:3000"
TOKEN="dev-permanent-test-token-admin-2025"
HEADERS="-H 'Authorization: Bearer $TOKEN' -H 'Content-Type: application/json'"

# æµ‹è¯•è®¡æ•°å™¨
TOTAL_TESTS=0
PASSED_TESTS=0
FAILED_TESTS=0

# æµ‹è¯•å‡½æ•°
test_api() {
    local test_name="$1"
    local expected="$2"
    local actual="$3"
    
    TOTAL_TESTS=$((TOTAL_TESTS + 1))
    
    if [ "$actual" = "$expected" ]; then
        echo "âœ… $test_name: PASSED"
        PASSED_TESTS=$((PASSED_TESTS + 1))
    else
        echo "âŒ $test_name: FAILED (Expected: $expected, Actual: $actual)"
        FAILED_TESTS=$((FAILED_TESTS + 1))
    fi
}

# æ‰§è¡Œæ‰€æœ‰æµ‹è¯•...
# (è¿™é‡Œå¯ä»¥æ·»åŠ å…·ä½“çš„æµ‹è¯•é€»è¾‘)

echo "ğŸ“Š æµ‹è¯•ç»“æœç»Ÿè®¡:"
echo "æ€»æµ‹è¯•æ•°: $TOTAL_TESTS"
echo "é€šè¿‡: $PASSED_TESTS"
echo "å¤±è´¥: $FAILED_TESTS"
echo "æˆåŠŸç‡: $(( PASSED_TESTS * 100 / TOTAL_TESTS ))%"
```

---

**ç‰ˆæœ¬**: v1.0  
**åˆ›å»ºæ—¶é—´**: 2025-01-13  
**æœ€åæ›´æ–°**: 2025-01-13  
**æµ‹è¯•è´Ÿè´£äºº**: AI Assistant 