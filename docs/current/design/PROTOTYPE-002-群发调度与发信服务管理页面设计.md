# PROTOTYPE-002-群发调度与发信服务管理页面设计

## 1. 发信人管理页面

### 页面P01: 发信人管理页面
**页面目标**: 提供发信人的创建、查看、删除功能
**用户角色**: 营销运营人员
**菜单位置**: 发件管理 → 发信人管理

**输入项**:
- 发信人名称输入框：文本输入，必填，全系统唯一性验证
- 搜索框：支持按发信人名称搜索过滤

**输出项**:
- 发信人列表表格：
  - 发信人名称
  - 创建时间
  - 关联任务数量
  - 操作按钮（删除）
- 新增按钮：打开创建发信人弹窗
- 分页控件：支持列表分页显示

**路径跳转说明**:
- 点击"新增"按钮 → 打开创建发信人弹窗
- 点击"删除"按钮 → 弹出确认对话框
- 删除成功后 → 刷新列表，保持当前页面

**异常处理**:
- 发信人名称重复 → 显示错误提示"发信人名称已存在"
- 删除被使用的发信人 → 显示警告"该发信人正在被X个任务使用，无法删除"
- 网络错误 → 显示"操作失败，请重试"

**页面字段结构**:
```json
{
  "senderList": [
    {
      "id": "发信人ID",
      "name": "发信人名称",
      "createdAt": "创建时间",
      "taskCount": "关联任务数量",
      "canDelete": "是否可删除"
    }
  ],
  "pagination": {
    "current": "当前页码",
    "total": "总条数",
    "pageSize": "每页显示数量"
  }
}
```

---

## 2. 群发任务管理页面（增强版）

### 页面P02: 群发任务列表页面
**页面目标**: 显示群发任务列表，支持任务状态管理
**用户角色**: 营销运营人员
**菜单位置**: 发件管理 → 群发任务

**输入项**:
- 任务状态筛选：下拉选择（全部/待执行/执行中/已完成/已暂停/已失败/已取消）
- 发信人筛选：下拉选择当前用户创建的发信人
- 时间范围筛选：日期选择器，支持创建时间和计划执行时间筛选
- 搜索框：支持按任务名称搜索

**输出项**:
- 任务列表表格：
  - 任务名称
  - 发信人名称
  - 计划发送人数
  - 已发送数量
  - 成功数量
  - 失败数量
  - 任务状态（带颜色标识）
  - 创建时间
  - 计划执行时间
  - 操作按钮（暂停/恢复/取消/查看详情）
- 新增任务按钮
- 批量操作按钮：批量暂停/取消

**路径跳转说明**:
- 点击"新增任务" → 跳转任务创建页面
- 点击"查看详情" → 跳转任务详情页面
- 点击任务名称 → 跳转任务详情页面

**异常处理**:
- 操作权限不足 → 显示"无权限操作此任务"
- 状态不允许操作 → 显示"当前状态不允许此操作"
- 网络请求失败 → 显示"操作失败，请重试"

**页面字段结构**:
```json
{
  "taskList": [
    {
      "id": "任务ID",
      "name": "任务名称",
      "senderName": "发信人名称",
      "totalCount": "计划发送人数",
      "sentCount": "已发送数量",
      "successCount": "成功数量",
      "failCount": "失败数量",
      "status": "任务状态",
      "createdAt": "创建时间",
      "scheduledAt": "计划执行时间",
      "allowedActions": ["暂停", "恢复", "取消", "查看"]
    }
  ]
}
```

---

### 页面P03: 群发任务创建/编辑页面（增强版）
**页面目标**: 创建新的群发任务，增加发信人选择和额度检查
**用户角色**: 营销运营人员
**菜单位置**: 发件管理 → 群发任务 → 新增

**输入项**:
- 任务基本信息：
  - 任务名称：文本输入，必填
  - 任务描述：文本域，可选
- 发信人选择：下拉选择，从用户创建的发信人中选择，必填
- 收信人设置：
  - 标签选择：多选框，支持"与"/"或"/"非"逻辑组合
  - 预览收信人数量：实时显示选中标签对应的人数
- 邮件内容设置：
  - 邮件模板选择：多选框，支持选择多个模板进行均匀分配
  - 模板预览：显示选中模板的内容预览（支持多个模板切换查看）
- 发送设置：
  - 发送时间：立即发送/定时发送（日期时间选择器）
  - 发送频率控制：系统自动调度（显示说明文字）

**输出项**:
- 当前用户剩余额度显示：醒目位置显示
- 本次任务预计消耗额度：根据收信人数量实时计算
- 额度充足性检查结果：充足显示绿色，不足显示红色警告
- 保存按钮：额度不足时禁用
- 预览按钮：预览最终邮件效果
- 取消按钮：返回任务列表

**路径跳转说明**:
- 点击"保存" → 保存成功后跳转任务列表
- 点击"取消" → 返回任务列表
- 点击"预览" → 打开邮件预览弹窗

**异常处理**:
- 额度不足 → 显示"当前剩余额度不足，需要X额度，剩余Y额度"
- 选择标签为空 → 显示"请至少选择一个标签"
- 必填项为空 → 对应字段显示红色错误提示
- 发信人未选择 → 显示"请选择发信人"

**页面字段结构**:
```json
{
  "task": {
    "name": "任务名称",
    "description": "任务描述",
    "senderId": "发信人ID",
    "senderName": "发信人名称",
    "tagIds": ["标签ID数组"],
    "tagLogic": "标签逻辑（AND/OR/NOT）",
    "templateIds": ["邮件模板ID数组"],
    "scheduleType": "发送类型（immediate/scheduled）",
    "scheduledAt": "计划发送时间",
    "recipientCount": "收信人数量",
    "quotaRequired": "需要额度",
    "quotaAvailable": "可用额度",
    "quotaSufficient": "额度是否充足"
  }
}
```

---

### 页面P04: 群发任务详情页面
**页面目标**: 查看任务详细信息和子任务执行情况
**用户角色**: 营销运营人员
**菜单位置**: 群发任务列表 → 查看详情

**输入项**:
- 子任务状态筛选：下拉选择（全部/待发送/发送中/已发送/发送失败）
- 收信人邮箱搜索：支持模糊搜索
- 发信服务筛选：下拉选择（显示本任务使用的发信服务）

**输出项**:
- 任务基本信息卡片：
  - 任务名称、状态、发信人
  - 总发送数、成功数、失败数、成功率
  - 创建时间、开始时间、结束时间
  - 操作按钮（暂停/恢复/取消，根据状态显示）
- 实时进度条：显示任务执行进度
- 子任务列表表格：
  - 收信人邮箱
  - 发信地址（发信人@发信服务域名）
  - 子任务状态
  - 发送时间
  - 失败原因（如有）
- 统计图表：按发信服务统计发送情况

**路径跳转说明**:
- 点击"返回列表" → 返回群发任务列表
- 点击子任务的收信人邮箱 → 跳转联系人详情（如需要）

**异常处理**:
- 任务不存在 → 显示404页面
- 无权限查看 → 显示"无权限查看此任务"
- 数据加载失败 → 显示重试按钮

**页面字段结构**:
```json
{
  "taskDetail": {
    "id": "任务ID",
    "name": "任务名称",
    "status": "任务状态",
    "senderName": "发信人名称",
    "totalCount": "总发送数",
    "successCount": "成功数",
    "failCount": "失败数",
    "successRate": "成功率",
    "progress": "进度百分比",
    "createdAt": "创建时间",
    "startedAt": "开始时间",
    "finishedAt": "结束时间"
  },
  "subtasks": [
    {
      "id": "子任务ID",
      "recipientEmail": "收信人邮箱",
      "senderAddress": "发信地址",
      "status": "子任务状态",
      "sentAt": "发送时间",
      "failReason": "失败原因"
    }
  ]
}
```

---

## 3. 发信服务管理页面（管理员专用）

### 页面P05: 发信服务管理页面
**页面目标**: 管理发信服务配置和监控服务状态
**用户角色**: 系统管理员
**菜单位置**: 系统管理 → 发信服务管理

**输入项**:
- 服务状态筛选：下拉选择（全部/启用/禁用/冻结）
- 服务名称搜索：文本输入框
- 额度调整弹窗：
  - 当日剩余额度：数字输入框
  - 调整原因：文本域

**输出项**:
- 服务概览卡片：显示总服务数、可用服务数、冻结服务数
- 发信服务列表表格：
  - 服务名称
  - 发信域名
  - 邮局服务类型（engagelab）
  - 每日额度
  - 当日剩余额度（可点击调整）
  - 发信频率（秒）
  - 额度重置时间
  - 服务状态（启用/禁用/冻结，带颜色标识）
  - 连续失败次数
  - 上次重置时间
  - 操作按钮（编辑/启用禁用/手动恢复）
- 新增服务按钮

**路径跳转说明**:
- 点击"新增服务" → 打开创建服务弹窗
- 点击"编辑" → 打开编辑服务弹窗
- 点击剩余额度 → 打开额度调整弹窗

**异常处理**:
- API凭证验证失败 → 显示"API凭证验证失败，请检查"
- 发信域名格式错误 → 显示"请输入正确的域名格式"
- 额度调整失败 → 显示"额度调整失败，请重试"
- 服务状态变更失败 → 显示具体失败原因

**页面字段结构**:
```json
{
  "serviceOverview": {
    "totalCount": "总服务数",
    "enabledCount": "可用服务数",
    "frozenCount": "冻结服务数"
  },
  "serviceList": [
    {
      "id": "服务ID",
      "name": "服务名称",
      "domain": "发信域名",
      "provider": "邮局服务类型",
      "apiUser": "API用户名",
      "apiKey": "API密钥（加密显示）",
      "dailyLimit": "每日额度",
      "remainingQuota": "当日剩余额度",
      "sendInterval": "发信频率",
      "resetTime": "额度重置时间",
      "status": "服务状态",
      "failureCount": "连续失败次数",
      "lastResetAt": "上次重置时间"
    }
  ]
}
```

---

### 页面P06: 发信服务创建/编辑弹窗
**页面目标**: 创建或编辑发信服务配置
**用户角色**: 系统管理员
**触发方式**: 从发信服务管理页面打开

**输入项**:
- 服务名称：文本输入，必填
- 发信域名：文本输入，必填，格式验证
- 邮局服务：下拉选择，默认engagelab
- API用户名：文本输入，必填
- API密钥：密码输入，必填，编辑时显示加密字符
- 每日发送额度：数字输入，必填，正整数
- 发信频率：数字输入，必填，正整数，单位秒
- 额度重置时间：时间选择器，HH:MM格式

**输出项**:
- 表单验证提示：实时显示字段错误信息
- 保存按钮：表单验证通过后启用
- 取消按钮：关闭弹窗
- API凭证测试按钮：验证API凭证有效性

**路径跳转说明**:
- 点击"保存" → 保存成功后关闭弹窗，刷新列表
- 点击"取消" → 关闭弹窗，不保存更改
- 点击"测试凭证" → 发送测试请求验证API

**异常处理**:
- 必填项为空 → 字段下方显示红色错误提示
- 域名格式错误 → 显示"请输入正确的域名格式（如：example.com）"
- API测试失败 → 显示"API凭证验证失败：具体错误信息"
- 保存失败 → 显示具体失败原因

---

## 4. 用户管理页面（管理员专用）

### 页面P07: 用户管理页面
**页面目标**: 管理系统用户账户和发信额度
**用户角色**: 系统管理员
**菜单位置**: 系统管理 → 用户管理

**输入项**:
- 用户角色筛选：下拉选择（全部/管理员/普通用户）
- 账户状态筛选：下拉选择（全部/启用/禁用）
- 用户名搜索：文本输入框
- 额度调整弹窗：
  - 剩余额度：数字输入框
  - 调整原因：文本域

**输出项**:
- 用户概览卡片：显示总用户数、在线用户数、禁用用户数
- 用户列表表格：
  - 用户名
  - 邮箱
  - 用户角色
  - 剩余发信额度（可点击调整）
  - 账户状态（启用/禁用）
  - 最后登录时间
  - 创建时间
  - 操作按钮（编辑/启用禁用/重置密码）
- 新增用户按钮

**路径跳转说明**:
- 点击"新增用户" → 打开创建用户弹窗
- 点击"编辑" → 打开编辑用户弹窗
- 点击剩余额度 → 打开额度调整弹窗

**异常处理**:
- 用户名邮箱重复 → 显示"用户名或邮箱已存在"
- 密码强度不够 → 显示密码强度要求
- 额度调整失败 → 显示"额度调整失败，请重试"

**页面字段结构**:
```json
{
  "userOverview": {
    "totalCount": "总用户数",
    "onlineCount": "在线用户数",
    "disabledCount": "禁用用户数"
  },
  "userList": [
    {
      "id": "用户ID",
      "username": "用户名",
      "email": "邮箱",
      "role": "用户角色",
      "remainingQuota": "剩余发信额度",
      "status": "账户状态",
      "lastLoginAt": "最后登录时间",
      "createdAt": "创建时间"
    }
  ]
}
```

---

### 页面P08: 用户Dashboard页面
**页面目标**: 普通用户查看个人信息和剩余额度
**用户角色**: 普通用户
**菜单位置**: 首页Dashboard

**输入项**:
- 刷新按钮：手动刷新额度信息

**输出项**:
- 个人信息卡片：
  - 用户名
  - 邮箱
  - 最后登录时间
- 额度信息卡片：
  - 剩余发信额度（大号字体显示）
  - 额度充足性状态（绿色充足/红色不足）
  - 额度不足提醒（如适用）
- 快捷操作区域：
  - 创建群发任务按钮
  - 管理发信人按钮
  - 查看任务列表按钮

**路径跳转说明**:
- 点击"创建群发任务" → 跳转任务创建页面
- 点击"管理发信人" → 跳转发信人管理页面
- 点击"查看任务列表" → 跳转群发任务列表

**异常处理**:
- 额度信息加载失败 → 显示"额度信息加载失败，请刷新"
- 额度不足 → 显示醒目的红色提醒

---

## 5. 用户可用发信服务管理页面（管理员专用）

### 页面P09: 用户可用发信服务管理页面
**页面目标**: 管理用户与发信服务的关联关系
**用户角色**: 系统管理员
**菜单位置**: 系统管理 → 用户服务关联

**输入项**:
- 用户选择：下拉选择，显示所有普通用户
- 发信服务多选：复选框组，显示所有可用发信服务
- 用户搜索：支持按用户名搜索过滤

**输出项**:
- 关联关系列表表格：
  - 用户名
  - 关联的发信服务列表（标签形式显示）
  - 关联的服务数量
  - 最后更新时间
  - 操作按钮（编辑关联）
- 新增关联按钮

**路径跳转说明**:
- 点击"新增关联" → 打开关联设置弹窗
- 点击"编辑关联" → 打开编辑关联弹窗

**异常处理**:
- 用户已有关联 → 弹窗提示"用户已有关联关系，是否更新？"
- 选择服务为空 → 显示"请至少选择一个发信服务"
- 关联保存失败 → 显示具体失败原因

**页面字段结构**:
```json
{
  "userServiceList": [
    {
      "userId": "用户ID",
      "username": "用户名",
      "serviceNames": ["关联的发信服务名称数组"],
      "serviceCount": "关联服务数量",
      "updatedAt": "最后更新时间"
    }
  ],
  "availableServices": [
    {
      "id": "服务ID",
      "name": "服务名称",
      "status": "服务状态"
    }
  ]
}
```

---

**文档版本**: v1.0  
**创建日期**: 2025-01-27  
**负责人**: 原型设计Agent 