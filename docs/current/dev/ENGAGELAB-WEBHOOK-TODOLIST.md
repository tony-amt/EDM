# EngageLab Webhook 开发和测试 TodoList

## 📋 第一阶段：本地测试环境搭建

### 1. Webhook 路径确认和优化
- [x] 确认现有webhook路径：`POST /api/tracking/webhook/engagelab`
- [ ] 创建本地测试脚本模拟EngageLab回调
- [ ] 验证webhook签名验证逻辑
- [ ] 测试各种事件类型处理

### 2. 本地模拟测试
- [ ] 创建邮件发送测试数据
- [ ] 模拟邮件状态事件（delivered, opened, clicked等）
- [ ] **重点测试邮件回复事件（reply, inbound）**
- [ ] 验证会话创建和消息记录功能
- [ ] 测试用户匹配逻辑

### 3. 数据库准备
- [ ] 确认EmailConversation和EmailMessage表结构
- [ ] 创建测试用户和发信服务数据
- [ ] 准备测试联系人数据

## 📋 第二阶段：邮件会话前后端集成

### 4. 后端API完善
- [ ] 完善会话列表API (`GET /api/conversations`)
- [ ] 完善会话详情API (`GET /api/conversations/:id`)
- [ ] 完善发送回复API (`POST /api/conversations/:id/reply`)
- [ ] 添加会话状态管理API
- [ ] 完善错误处理和日志记录

### 5. 前端页面开发
- [ ] 创建邮件会话列表页面
- [ ] 创建邮件会话详情页面
- [ ] 实现回复邮件功能
- [ ] 添加实时消息更新（WebSocket或轮询）
- [ ] 完善UI/UX交互

### 6. 前后端集成测试
- [ ] 测试会话列表加载
- [ ] 测试会话详情显示
- [ ] 测试邮件回复发送
- [ ] 测试收到回复后的实时更新
- [ ] 端到端测试完整邮件往来流程

## 📋 第三阶段：生产环境部署准备

### 7. 生产环境配置
- [ ] 配置生产环境HTTPS
- [ ] 设置公网可访问的webhook URL
- [ ] 配置EngageLab控制台webhook设置
- [ ] 设置环境变量和签名验证

### 8. 生产测试
- [ ] 真实EngageLab环境webhook测试
- [ ] 发送测试邮件验证回调
- [ ] 测试邮件回复接收功能
- [ ] 性能和稳定性测试

## 🎯 优先级标识
- 🔥 **高优先级**：本地webhook测试和邮件回复处理
- ⚡ **中优先级**：前端会话界面开发
- 📈 **低优先级**：生产环境部署配置

## 📝 测试用例准备
### EngageLab 回调事件类型
1. **邮件状态事件**
   - `delivered` - 邮件送达
   - `opened` - 邮件打开
   - `clicked` - 链接点击
   - `bounced` - 邮件退回
   - `spam_report` - 垃圾举报
   - `unsubscribe` - 退订

2. **邮件回复事件** 🔥
   - `reply` - 邮件回复
   - `inbound` - 入站邮件

## 📊 预期测试结果
- [ ] Webhook能正确接收和解析EngageLab回调
- [ ] 邮件回复能自动创建或更新会话
- [ ] 前端能正确显示邮件往来记录
- [ ] 用户能在前端回复邮件并发送成功
- [ ] 整个邮件会话流程端到端工作正常

---

**开始时间**: {今天日期}
**预计完成时间**: 第一、二阶段 3-5个工作日
**负责人**: 开发团队
**当前状态**: 准备开始第一阶段 