# SPEC-002-A.MT邮件冷发系统V2.0产品需求说明书-第三部分

### 4.4 发信系统与路由机制

#### 4.4.1 发件通道管理 (F10)

##### 功能描述

多发件通道配置与管理，确保邮件高效稳定发送。

##### 详细需求

1. **发信API集成**
   - 极光发信API集成
   - 支持API密钥管理
   - 提供连接测试功能
   - 支持API请求日志记录

2. **发件人信息管理**
   - 支持管理发件人名称/签名/头像
   - 提供发件人分组功能
   - 支持发件人轮换策略配置
   - 提供发件人效果分析

3. **通道状态监控**
   - 显示通道可用性状态
   - 监控每日限额和已使用量
   - 显示每日恢复限额时间点
   - 监控黑名单状态和趋势
   - 提供通道健康评分

4. **通道测试与验证**
   - 支持发送测试邮件
   - 提供送达率测试工具
   - 支持垃圾邮件测试
   - 提供不同邮箱服务商兼容性测试

5. **备用通道管理**
   - 配置主备通道策略
   - 设置自动切换条件
   - 提供手动切换功能
   - 支持通道恢复后的策略设定

##### 业务规则

1. 每个通道必须设置日发送限额
2. 通道状态每15分钟自动检测一次
3. 连续3次送达率低于80%自动标记为异常
4. 测试邮件不计入正式发送限额
5. 备用通道优先级可手动调整

##### 界面原型

发件通道管理界面应包括：
- 通道列表和状态概览
- 通道详情配置面板
- 监控指标仪表盘
- 测试工具面板
- 日志和告警区域

#### 4.4.2 发信路由策略 (F11)

##### 功能描述

智能路由策略确保最佳发送效果，根据多种因素动态分配发送任务。

##### 详细需求

1. **任务路由机制**
   - 针对邮件任务批次，以及用户可用的发信服务，由可用的发信服务认领任务中的每一次发信子任务
   - 提供路由决策可视化
   - 支持手动调整路由规则
   - 提供路由策略模拟测试

2. **用户可用发信服务判断**
   - 系统配置用户可用的发信服务
   - 检查用户整体发信额度是否大于0
   - 判断用户关联的发信服务是否为正常状态(非禁用且当日发信额度大于0)
   - 判断用户关联的发信服务是否处于时间间隔中(每个发信服务设定发信时间间隔)

3. **负载均衡与优化**
   - 同一个发信服务，关联多个用户或者多个任务调用时，按照任务创建时间轮询
   - 支持基于历史表现的动态权重调整
   - 提供服务级别保障(SLA)配置
   - 支持峰值流量智能分配

4. **域名保护机制**
   - 实施IP轮换保护机制
   - 提供域名声誉监控
   - 支持域名预热计划
   - 自动检测并隔离问题域名

5. **异常处理机制**
   - 发送失败后的处理策略
   - 通道不可用时的任务重新分配
   - 任务积压时的优先级处理
   - 系统过载保护机制

##### 业务规则

1. 路由决策优先考虑用户额度和服务状态
2. 轮询机制确保任务公平分配
3. 同一域名收件人优先使用同一发信通道
4. 特定国家/地区收件人可指定优先通道
5. 高优先级任务可抢占资源

##### 界面原型

发信路由策略界面应包括：
- 路由规则配置面板
- 用户-服务关联管理
- 实时路由决策流程图
- 服务负载均衡监控
- 异常处理配置

### 4.5 私域管理模块

#### 4.5.1 基础用户画像 (F11)

##### 功能描述

构建以邮箱为中心的用户基础画像，整合多维度信息支持精准营销和个性化沟通。

##### 详细需求

1. **用户基础信息整合**
   - 整合联系人基本信息(邮箱、姓名等)
   - 关联所属标签信息
   - 汇总历史互动数据
   - 提供用户360度视图
   - 支持手动添加备注信息

2. **互动行为记录**
   - 追踪邮件打开行为(次数、时间、设备)
   - 记录邮件点击行为(链接、时间、来源)
   - 统计邮件回复情况(次数、内容摘要)
   - 分析互动模式和偏好
   - 提供行为时间线视图

3. **生命周期状态管理**
   - 自动标记生命周期状态(新用户/活跃/沉默/流失)
   - 提供状态变化历史记录
   - 支持自定义状态规则
   - 基于状态提供营销建议
   - 支持批量状态更新

4. **社媒账号信息记录**
   - 关联社交媒体账号(TikTok、Instagram、YouTube等)
   - 记录个性签名和简介
   - 追踪粉丝数变化趋势
   - 统计发贴数和互动情况
   - 支持手动/自动更新社媒数据

5. **社媒内容记录**
   - 关联社交媒体发布内容
   - 存储发文链接和内容摘要
   - 记录发文时间和主题分类
   - 追踪内容互动数据(点赞、评论、分享)
   - 支持内容关键词分析

##### 业务规则

1. 用户邮箱作为核心标识符
2. 社媒数据更新频率不超过每周一次
3. 生命周期状态每日自动更新
4. 用户画像数据保留期为24个月
5. 敏感个人信息需遵循数据保护法规

##### 界面原型

用户画像界面应包括：
- 用户基本信息卡片
- 互动历史时间线
- 标签和属性展示区
- 社媒账号和内容概览
- 行为分析图表
- 营销建议面板

#### 4.5.2 互动历史管理 (F12)

##### 功能描述

管理与用户的邮件互动历史，支持全面了解用户沟通状态和优化后续营销策略。

##### 详细需求

1. **邮件往来历史记录**
   - 时间线形式展示邮件往来完整记录
   - 支持按任务/主题/时间段筛选
   - 提供往来邮件全文搜索
   - 显示邮件状态(已发送/已打开/已回复)
   - 支持手动添加沟通记录

2. **回复内容归档**
   - 自动归档用户回复邮件
   - 提供回复内容摘要和分类
   - 支持重要回复标记和备注
   - 自动提取回复中的关键信息
   - 支持回复模板建议

3. **互动事件时间线**
   - 可视化展示所有互动事件
   - 支持事件筛选和聚合显示
   - 提供关键事件突出显示
   - 支持添加自定义事件
   - 提供时间段比较分析

4. **互动频率分析**
   - 分析邮件往来频率变化趋势
   - 提供最佳联系时间建议
   - 分析回复速度和模式
   - 支持与同群组用户对比
   - 提供互动健康度评分

5. **关键互动标记**
   - 支持手动标记关键互动事件
   - 提供自动重要互动识别
   - 关键互动提醒和通知
   - 支持团队协作标记和备注
   - 基于关键互动生成后续行动建议

##### 业务规则

1. 邮件互动历史保留期为24个月
2. 系统自动分类回复内容(积极/中性/消极)
3. 关键互动默认包括首次回复、投诉、合作意向等
4. 互动频率异常变化触发提醒
5. 团队成员可查看共享联系人的互动历史

##### 界面原型

互动历史管理界面应包括：
- 互动时间线主视图
- 邮件内容预览面板
- 互动分析图表区
- 标记和备注工具
- 筛选和搜索控件
- 行动建议面板

### 4.6 系统管理与安全

#### 4.6.1 用户权限管理 (F13)

##### 功能描述

多级用户权限与操作审计，确保系统安全和数据访问控制。

##### 详细需求

1. **角色权限管理**
   - 支持预定义角色(管理员/操作员/只读用户)
   - 提供自定义角色创建功能
   - 支持角色继承和覆盖
   - 提供角色模板复制功能
   - 支持临时角色和权限设置

2. **功能权限控制**
   - 细粒度功能模块权限设置
   - 支持操作级别权限控制(查看/编辑/删除)
   - 提供批量权限分配工具
   - 支持权限依赖和冲突检测
   - 提供权限预览和测试功能

3. **数据访问权限控制**
   - 支持基于标签/分组的数据访问控制
   - 提供字段级别的权限管理
   - 支持数据脱敏和掩码设置
   - 提供数据导出权限控制
   - 支持敏感操作多因素认证

4. **操作日志审计**
   - 记录所有关键操作日志
   - 提供日志搜索和筛选功能
   - 支持异常操作告警
   - 提供操作日志报表
   - 支持日志导出和归档

5. **登录安全管理**
   - 支持多因素认证
   - 提供登录IP限制
   - 支持会话超时设置
   - 记录登录历史和异常检测
   - 提供密码策略管理

##### 业务规则

1. 系统默认角色不可删除
2. 至少保留一个管理员账号
3. 敏感操作需要二次确认
4. 操作日志保留期为12个月
5. 连续5次登录失败自动锁定账号

##### 界面原型

用户权限管理界面应包括：
- 用户和角色列表
- 权限矩阵配置面板
- 数据访问规则设置
- 操作日志查询工具
- 安全策略配置区域

#### 4.6.2 系统配置 (F14)

##### 功能描述

系统全局配置与资源管理，确保系统高效运行和资源合理分配。

##### 详细需求

1. **系统参数配置**
   - 提供核心系统参数设置
   - 支持界面主题和语言配置
   - 提供系统通知和告警设置
   - 支持定时任务配置
   - 提供系统维护窗口设置

2. **发送限额设置**
   - 支持系统级别发送总限额设置
   - 提供用户/角色级别限额分配
   - 支持限额周期设置(日/周/月)
   - 提供限额使用分析和预警
   - 支持临时限额调整

3. **黑名单管理**
   - 支持域名级黑名单管理
   - 提供邮箱级黑名单管理
   - 支持IP黑名单管理
   - 提供自动黑名单规则设置
   - 支持黑名单导入/导出

4. **系统状态监控**
   - 提供系统关键指标实时监控
   - 支持系统性能分析
   - 提供服务可用性监控
   - 支持资源使用率监控
   - 提供自定义监控告警

5. **资源使用统计**
   - 提供用户级别资源使用统计
   - 支持发送量趋势分析
   - 提供存储空间使用分析
   - 支持API调用统计
   - 提供成本分析报表

##### 业务规则

1. 关键系统参数变更需管理员权限
2. 发送限额不可超过系统总限额
3. 自动加入黑名单的条件需经过确认
4. 系统状态异常需触发多渠道告警
5. 资源使用统计每日更新一次

##### 界面原型

系统配置界面应包括：
- 参数配置面板
- 限额管理矩阵
- 黑名单管理工具
- 系统监控仪表盘
- 资源使用报表视图

## 5. 非功能需求

### 5.1 性能需求

1. **响应时间**
   - 页面加载时间：90%页面应在3秒内完成加载
   - 数据查询响应：90%查询应在2秒内返回结果
   - 表单提交响应：90%表单提交应在3秒内得到响应

2. **吞吐量**
   - 系统应支持每小时处理100万封邮件发送
   - 支持每小时处理10万次邮件追踪事件(打开/点击)
   - 支持100个并发用户操作

3. **可扩展性**
   - 系统应能横向扩展以支持增长的用户量和发送量
   - 数据库设计应支持亿级联系人数据存储和高效查询

4. **资源利用率**
   - CPU利用率平均不超过70%
   - 内存使用率平均不超过75%
   - 存储空间利用率不超过85%

### 5.2 安全需求

1. **数据安全**
   - 所有敏感数据(如API密钥)需加密存储
   - 联系人数据需遵循数据保护法规要求
   - 数据备份策略：每日增量备份，每周全量备份
   - 备份数据保留30天

2. **访问控制**
   - 实施基于角色的访问控制(RBAC)
   - 敏感操作需多因素认证
   - 会话超时：管理员30分钟，普通用户60分钟
   - API访问需要令牌验证

3. **传输安全**
   - 所有HTTP通信强制使用HTTPS
   - API通信采用TLS 1.2或更高版本
   - 实施CSP(内容安全策略)防御XSS攻击
   - 实施CSRF防护措施

4. **审计与合规**
   - 记录所有关键操作的审计日志
   - 合规性支持：GDPR, CAN-SPAM, 中国《网络安全法》
   - 定期安全审计和漏洞扫描
   - 支持数据删除请求处理

### 5.3 可用性需求

1. **系统可用性**
   - 系统可用性目标：99.9%(每月最多43分钟不可用)
   - 计划内维护时间：每月不超过4小时，提前7天通知
   - 关键功能降级机制：邮件发送功能在系统部分不可用时仍能工作

2. **容错能力**
   - 任何单点故障不应导致整个系统不可用
   - 自动故障检测和恢复机制
   - 关键服务的负载均衡和冗余部署
   - 数据库主从复制和自动故障转移

3. **灾难恢复**
   - RPO(恢复点目标)：24小时
   - RTO(恢复时间目标)：4小时
   - 异地灾备数据中心
   - 灾难恢复演练：每季度一次

4. **监控与告警**
   - 全面的系统监控覆盖所有关键组件
   - 多级别告警机制：信息、警告、严重
   - 多渠道告警通知：邮件、短信、电话
   - 自动化运维响应流程

### 5.4 可扩展性需求

1. **技术扩展性**
   - 模块化架构设计，支持功能模块独立升级
   - 微服务架构，支持服务独立扩展
   - 标准化API接口，支持第三方集成
   - 支持水平扩展，通过增加节点提升系统容量

2. **业务扩展性**
   - 支持新增邮件发送通道集成
   - 支持新增社交媒体平台集成
   - 可配置的数据模型，支持自定义字段
   - 支持多语言和国际化部署

3. **用户扩展性**
   - 支持多租户架构
   - 按需扩展资源配置
   - 灵活的计费和配额管理
   - 自助服务功能扩展

4. **数据扩展性**
   - 支持TB级数据存储和管理
   - 冷热数据分离策略
   - 支持数据分片和分布式存储
   - 高效的数据归档和检索机制

## 6. 界面要求

### 6.1 界面风格

1. **整体风格**
   - 简洁现代的扁平化设计
   - 专业商务风格，以蓝色为主色调
   - 一致的视觉语言和交互模式
   - 响应式设计，适配桌面和平板设备

2. **导航结构**
   - 左侧固定导航菜单
   - 顶部快捷操作栏
   - 面包屑导航
   - 快速搜索和常用功能快捷入口

3. **数据展示**
   - 清晰的数据层次和视觉优先级
   - 丰富的数据可视化图表
   - 支持表格数据的排序、筛选和导出
   - 适当使用动效提升用户体验

4. **交互设计**
   - 直观的拖放操作
   - 实时反馈和提示
   - 分步骤引导流程
   - 一致的错误处理和帮助信息

### 6.2 关键界面描述

1. **仪表盘**
   - 个性化数据概览
   - 关键指标卡片
   - 任务执行状态
   - 近期活动记录
   - 待办事项提醒

2. **联系人管理**
   - 高级搜索和筛选工具
   - 标签管理面板
   - 联系人详情页
   - 批量操作工具
   - 导入/导出向导

3. **任务创建**
   - 分步骤引导式设计
   - 目标人群可视化选择器
   - 模板预览和编辑
   - 发送计划配置
   - 最终确认页

4. **数据分析**
   - 多维度数据筛选器
   - 可交互图表展示
   - 数据钻取功能
   - 自定义报表生成器
   - 比较分析工具

5. **系统管理**
   - 用户和权限管理
   - 系统配置面板
   - 发信通道管理
   - 监控和告警中心
   - 审计日志查询

## 7. 实施计划

### 7.1 开发阶段

1. **阶段一：需求分析与设计**（4周）
   - 需求调研和分析
   - 系统架构设计
   - 数据库设计
   - 界面原型设计
   - 技术方案评审

2. **阶段二：核心功能开发**（8周）
   - 联系人和标签管理
   - 任务创建和调度
   - 基础模板管理
   - 发信通道集成
   - 用户权限管理

3. **阶段三：高级功能开发**（6周）
   - 数据分析功能
   - 多轮营销任务
   - AI内容模板
   - 私域管理功能
   - 系统监控和配置

4. **阶段四：集成测试与优化**（4周）
   - 系统集成测试
   - 性能测试和优化
   - 安全测试和加固
   - 用户体验优化
   - 文档完善

### 7.2 测试策略

1. **单元测试**
   - 覆盖核心业务逻辑
   - 自动化测试用例
   - 代码提交触发测试
   - 测试覆盖率目标：80%

2. **集成测试**
   - 模块间接口测试
   - 数据流测试
   - 第三方API集成测试
   - 端到端业务流程测试

3. **性能测试**
   - 负载测试（正常和峰值负载）
   - 压力测试（系统极限容量）
   - 耐久性测试（长时间运行稳定性）
   - 瓶颈识别和优化

4. **用户体验测试**
   - 内部用户测试
   - 选定客户Beta测试
   - 可用性评估
   - 反馈收集和迭代优化

### 7.3 上线策略

1. **环境准备**
   - 生产环境部署和配置
   - 数据迁移计划制定
   - 监控和告警系统部署
   - 备份和恢复机制验证

2. **试运行**
   - 选定部分用户试用
   - 功能验证和问题修复
   - 性能监控和调优
   - 运维流程验证

3. **全面上线**
   - 分批次用户迁移
   - 旧系统数据同步
   - 全天候技术支持
   - 关键指标监控

4. **运营支持**
   - 用户培训和文档
   - 常见问题解答
   - 定期系统健康检查
   - 持续优化和迭代

## 8. 附录

### 8.1 功能与用户故事对应关系

| 功能编号 | 功能名称 | 关联用户故事 |
| -------- | -------- | ------------ |
| F01 | 联系人管理 | US01, US02, US03 |
| F02 | 标签体系 | US04, US05, US06 |
| F03 | 任务创建 | US07, US08 |
| F04 | 任务调度与监控 | US09, US10 |
| F05 | 任务数据分析 | US11, US12 |
| F06 | 多轮营销任务 | US13 |
| F07 | 正文模板管理 | US14, US15 |
| F08 | AI内容模板 | US16 |
| F09 | 底部模板管理 | US17 |
| F10 | 发件通道管理 | US18 |
| F11 | 发信路由策略 | US19 |
| F11 | 基础用户画像 | US20 |
| F12 | 互动历史管理 | US21 |
| F13 | 用户权限管理 | US22 |
| F14 | 系统配置 | US23 |

### 8.2 数据字典

#### 联系人表

| 字段名 | 类型 | 描述 |
| ------ | ---- | ---- |
| id | string | 联系人唯一标识 |
| email | string | 邮箱地址 |
| username | string | 用户名 |
| tikTokId | string | TikTok唯一ID |
| insId | string | Instagram ID |
| youtubeId | string | YouTube ID |
| customField1-5 | string | 自定义字段1-5 |
| createTime | datetime | 创建时间 |
| updateTime | datetime | 更新时间 |
| status | enum | 状态(活跃/非活跃/已退订) |

#### 标签表

| 字段名 | 类型 | 描述 |
| ------ | ---- | ---- |
| id | string | 标签唯一标识 |
| name | string | 标签名称 |
| parentId | string | 父标签ID |
| level | int | 标签层级 |
| description | string | 标签描述 |
| createTime | datetime | 创建时间 |
| updateTime | datetime | 更新时间 |

#### 任务表

| 字段名 | 类型 | 描述 |
| ------ | ---- | ---- |
| id | string | 任务唯一标识 |
| name | string | 任务名称 |
| description | string | 任务描述 |
| targetTags | array | 目标标签组合 |
| templateId | string | 模板ID |
| senderId | string | 发件人ID |
| status | enum | 状态(草稿/待执行/执行中/已完成/已取消) |
| scheduleTime | datetime | 计划发送时间 |
| createTime | datetime | 创建时间 |
| updateTime | datetime | 更新时间 |
| creatorId | string | 创建者ID | 