# SPEC-002-A.MT邮件冷发系统V2.0产品需求说明书-第二部分

### 4.2 批量任务系统

#### 4.2.1 任务创建 (F03)

##### 功能描述

提供灵活的任务创建与配置界面，支持用户定义发送目标、内容和策略。

##### 详细需求

1. **任务基础信息设置**
   - 支持设置任务名称、描述
   - 任务优先级设置
   - 任务标签分类

2. **目标人群选择**
   - 支持通过标签组合选择目标人群
   - 标签组合支持"与"/"或"/"非"逻辑
   - 显示选中人群数量和基本属性分布
   - 支持保存常用人群筛选条件

3. **发送内容选择**
   - 支持选择固定模板或随机模板
   - 支持预览选中模板效果
   - 支持模板变量配置
   - 支持测试发送到指定邮箱

4. **发送配置**
   - 支持设置发件人信息
   - 支持设置回复邮箱
   - 支持设置邮件主题
   - 支持配置附件(如有)

5. **定时发送与分批设置**
   - 支持设置发送时间(立即/定时)
   - 支持配置分批策略(批次数/每批间隔)
   - 支持设置发送速率限制
   - 提供发送计划预览

##### 业务规则

1. 任务必须设置名称和目标人群
2. 目标人群为空时不允许创建任务
3. 定时任务最长可设置30天后执行
4. 单个任务最大支持100万收件人
5. 分批发送最多支持20个批次

##### 界面原型

任务创建界面应采用分步骤向导式设计：
- 步骤1：基本信息设置
- 步骤2：目标人群选择
- 步骤3：内容模板选择
- 步骤4：发送配置
- 步骤5：发送计划
- 最后：预览确认

#### 4.2.2 任务调度与监控 (F04)

##### 功能描述

智能调度任务执行并实时监控状态，确保邮件按计划高效发送。

##### 详细需求

1. **多任务并行处理**
   - 支持多个任务同时执行
   - 提供任务队列管理
   - 基于系统负载动态调整并行任务数

2. **任务执行状态监控**
   - 实时显示任务执行进度和状态
   - 提供详细的执行日志
   - 显示已发送/成功/失败/待发送数量
   - 支持错误原因查看和分析

3. **任务控制功能**
   - 支持任务暂停/恢复/取消操作
   - 支持修改未执行部分的发送计划
   - 提供任务优先级调整

4. **发送速率控制**
   - 支持域名/IP级别的发送速率限制
   - 系统自动平滑分配发送流量
   - 提供速率调整建议

5. **任务自动路由**
   - 任务根据可用的发信服务自动路由
   - 考虑服务状态、额度、时间间隔等因素
   - 发送异常时自动切换通道

##### 业务规则

1. 系统默认最大并行任务数为10
2. 失败不进行自动重试，需手动处理
3. 任务暂停超过7天自动取消
4. 发送速率上限受限于系统配置和发信通道限制

##### 界面原型

任务监控界面应包括：
- 任务列表视图(按状态分组)
- 任务详情视图(选中任务时)
- 实时进度图表
- 错误日志和告警信息
- 控制操作按钮(暂停/恢复/取消)

#### 4.2.3 任务数据分析 (F05)

##### 功能描述

提供任务执行效果的多维度分析，支持营销效果评估和优化。

##### 详细需求

1. **基础数据统计**
   - 发送量/送达率/打开率/点击率统计
   - 送达统计：收信箱返回成功
   - 打开统计：通过像素点追踪，记录打开次数和人数
   - 点击统计：通过中转页跟踪，记录点击次数和人数
   - 回复统计：以发信人名称汇总回复邮件数
   - 退订追踪：记录退订数量和原因

2. **数据可视化展示**
   - 提供关键指标仪表盘
   - 支持多维度图表展示
   - 支持数据钻取分析
   - 提供时间趋势分析

3. **分组比较分析**
   - 标签维度分析(不同标签群体效果对比)
   - 时间维度分析(不同时间段效果对比)
   - 内容维度分析(不同模板效果对比)
   - 发信服务对比分析(按天，管理员权限可见)

4. **用户行为分析**
   - 支持查看打开/点击/回复/退订/错误邮箱列表
   - 针对邮箱列表，支持创建标签进行二次营销或过滤
   - 提供用户行为路径分析
   - 支持高价值用户识别

5. **报表导出功能**
   - 支持数据导出为Excel/CSV/PDF
   - 支持定时报表自动生成
   - 提供报表模板定制

##### 业务规则

1. 数据实时统计，但存在最多30分钟延迟
2. 打开率计算基于成功送达的邮件数
3. 点击率计算基于已打开的邮件数
4. 回复统计有一定误差，仅作参考
5. 历史数据保留期为12个月

##### 界面原型

数据分析界面应包括：
- 顶部关键指标摘要
- 中部多维度图表展示
- 底部详细数据表格
- 侧边筛选和维度选择面板
- 导出和分享功能区

#### 4.2.4 多轮营销任务 (F06)

##### 功能描述

基于收信人的行为，进行T+N多轮营销，提高整体转化率。

##### 详细需求

1. **多轮营销计划创建**
   - 支持设置最多5轮营销计划
   - 每轮可创建最多3个子任务
   - 提供整体营销流程可视化视图
   - 支持复制和修改已有计划

2. **人群筛选规则**
   - 支持选择本次任务全部人群
   - 支持包含已打开/已点击/已回复人群
   - 支持剔除已打开/已点击/已回复人群
   - 默认剔除已退订人群
   - 提供受众预估规模

3. **时间触发设置**
   - 支持设置固定时间点触发
   - 支持设置相对时间触发(如首轮发送后X天)
   - 支持设置条件触发(如打开邮件后X小时)
   - 提供时间冲突检测

4. **内容策略配置**
   - 支持为每轮设置不同邮件模板
   - 支持内容连贯性检查
   - 提供内容个性化建议
   - 支持A/B测试配置

##### 业务规则

1. 多轮营销任务总周期不超过30天
2. 相邻两轮时间间隔至少1小时
3. 条件触发等待时间最长7天
4. 任何轮次可单独暂停或取消
5. 前序轮次结果异常时提供预警

##### 界面原型

多轮营销设置界面应包括：
- 营销流程时间线视图
- 轮次配置面板
- 人群规则设置区
- 内容预览区
- 整体预估效果展示

### 4.3 邮件内容管理模块

#### 4.3.1 正文模板管理-用户级 (F07)

##### 功能描述

提供邮件模板的创建、编辑与管理功能，支持多种编辑模式和变量定义。

##### 详细需求

1. **模板编辑功能**
   - 提供可视化模板编辑器
   - 支持HTML源码编辑模式
   - 支持拖放组件构建布局
   - 提供常用模板元素库
   - 支持移动设备响应式预览

2. **变量插入与管理**
   - 支持变量插入功能({{user}}等)
   - 提供变量定义模块
   - 支持定义变量名和对应的表+字段名
   - 提供变量默认值设置
   - 支持变量预览和测试

3. **模板组织与管理**
   - 支持模板分类与标签管理
   - 提供模板搜索和筛选
   - 支持模板复制和版本管理
   - 提供模板使用情况统计
   - 支持模板导入/导出

4. **模板测试与验证**
   - 支持不同邮件客户端兼容性检查
   - 提供垃圾邮件评分检测
   - 支持发送测试邮件
   - 提供链接和图片有效性检查

5. **模板性能分析**
   - 追踪模板使用频率
   - 分析模板效果数据(打开率/点击率)
   - 提供优化建议
   - 支持模板效果对比

##### 业务规则

1. 模板大小不超过500KB
2. 模板必须包含退订链接
3. 系统保留最近10个版本的模板历史
4. 被任务引用的模板不可删除
5. 默认提供10个基础模板供用户参考

##### 界面原型

模板管理界面应包括：
- 左侧模板分类树和列表
- 中部编辑器区域
- 右侧属性和变量面板
- 顶部操作工具栏
- 底部预览和测试区域

#### 4.3.2 AI内容模板 (F08)

##### 功能描述

支持针对收信人行为，通过AI模板prompt + 自定义变量，逐一生成个性化邮件内容。

##### 详细需求

1. **Prompt模板设置**
   - 支持设置统一prompt模板
   - 提供prompt编辑指南和最佳实践
   - 支持prompt模板保存和复用
   - 提供prompt效果预估评分

2. **变量与上下文管理**
   - 支持上传发信人变量，如名称、社媒签名、社媒内容、个性化标签等
   - 支持设置AI生成的上下文信息
   - 提供变量映射和格式化功能
   - 支持批量变量数据导入

3. **内容动态生成**
   - 针对AI内容模板，在每次发送前，针对每个发信人都调用AI动态生成邮件内容
   - 支持生成内容的人工审核
   - 提供生成失败的备用方案
   - 支持生成内容的微调和编辑

4. **生成效果优化**
   - 提供内容多样性控制
   - 支持语气和风格定制
   - 提供内容长度和复杂度调整
   - 基于历史效果数据自动优化prompt

5. **内容质量控制**
   - 提供内容合规性检查
   - 支持敏感词过滤
   - 提供语法和拼写检查
   - 支持内容相似度检测

##### 业务规则

1. 单次AI生成内容不超过3000字符
2. 生成请求超时时间为30秒
3. 每个用户每日生成内容配额根据套餐决定
4. 生成失败时自动使用备用模板
5. 所有生成内容需经过合规性检查

##### 界面原型

AI内容模板界面应包括：
- Prompt编辑区域
- 变量配置面板
- 生成效果预览窗口
- 内容微调工具
- 批量生成进度和结果展示

#### 4.3.3 底部模板管理-系统级 (F09)

##### 功能描述

按系统用户级，统一增加邮件HTML模板，并通过{{mail}}变量，放置正文内容位置。主要用于统一添加退订引导或品牌标识。

##### 详细需求

1. **底部模板设置**
   - 支持HTML格式模板
   - 通过{{mail}}变量定义正文位置
   - 支持多套底部模板管理
   - 提供默认模板设置

2. **模板应用规则**
   - 支持按用户/用户组分配不同底部模板
   - 支持设置模板优先级
   - 提供模板冲突检测
   - 支持设置强制应用规则

3. **合规元素管理**
   - 内置退订链接功能
   - 支持公司信息和地址配置
   - 提供隐私政策链接
   - 支持法律免责声明配置

4. **模板测试与预览**
   - 支持与不同正文模板组合预览
   - 提供邮件客户端兼容性检查
   - 支持发送测试邮件
   - 提供样式冲突检测

5. **国际化支持**
   - 支持多语言版本底部模板
   - 根据收件人地区自动选择合适的底部模板
   - 提供各国法规合规性检查
   - 支持字符集兼容性检查

##### 业务规则

1. 底部模板必须包含退订链接
2. 底部模板优先级高于用户模板
3. 所有外发邮件必须应用底部模板
4. 系统管理员拥有底部模板的最终编辑权
5. 底部模板变更需要审批流程

##### 界面原型

底部模板管理界面(管理员可见)：
- 模板列表和分类
- HTML编辑器
- 应用规则配置面板
- 预览与测试区域
- 合规检查报告 