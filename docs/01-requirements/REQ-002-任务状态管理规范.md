# 任务状态管理规范

## 文档信息
- 文档编号: REQ-002
- 创建日期: 2025-06-12
- 版本: v1.0
- 负责人: 系统架构师

## 主任务状态定义

### 1. 草稿 (draft)
**定义**: 未设定计划发送时间的任务
**操作功能**: 
- 启动发送
- 编辑
- 删除

### 2. 计划中 (scheduled)
**定义**: 即原来的已调度，表示已有计划发送时间，但时间还没到，还没开始分配子任务
**操作功能**: 
- 取消计划（状态回到草稿）
- 任务详情

### 3. 发送中 (sending)
**定义**: 已启动子任务的调度和发送，还有未完成的子任务或者计划
**操作功能**: 
- 暂停发送
- 任务详情

### 4. 发送完成 (completed)
**定义**: 全部子任务发送完成
**操作功能**: 
- 任务详情

### 5. 暂停中 (paused)
**定义**: 任务在发送过程中，手动暂停或者因发信服务余额不足而暂停，需要列表中说明暂停原因
**操作功能**: 
- 重新启动（可重新计划启动时间）
- 任务详情
- 关闭任务

### 6. 已关闭 (closed)
**定义**: 在任务启动后，暂停后，关闭操作，即进入任务已关闭状态，不可再启动
**操作功能**: 
- 任务详情

## 子任务状态定义

### 1. 待发送 (pending)
**定义**: 已分配发信服务、邮件模板、收信人，创建子任务成功，未发送

### 2. 发送中 (sending)
**定义**: 启动发送，未收到第三方发送服务反馈实时状态

### 3. 发送成功 (sent)
**定义**: 第三方发送服务反馈发信成功状态

### 4. 发送失败 (failed)
**定义**: 第三方发送服务反馈发信失败状态，并显示第三方反馈的失败原因

**注意**: 子任务均无主动操作按钮

## 状态流转图

```
草稿 (draft) 
    ↓ [启动发送]
计划中 (scheduled)
    ↓ [到达计划时间]
发送中 (sending)
    ↓ [全部子任务完成]
发送完成 (completed)

发送中 (sending)
    ↓ [手动暂停/余额不足]
暂停中 (paused)
    ↓ [重新启动]
发送中 (sending)
    ↓ [关闭任务]
已关闭 (closed)

计划中 (scheduled)
    ↓ [取消计划]
草稿 (draft)
```

## 实现要求

### 前端显示
1. 任务列表中需要显示对应的操作按钮
2. 暂停中状态需要显示暂停原因
3. 状态标签需要使用统一的颜色和文案

### 后端逻辑
1. 状态变更需要记录变更时间和原因
2. 自动状态检查机制确保状态一致性
3. 暂停原因需要持久化存储

### API接口
1. 提供状态变更接口
2. 支持批量状态查询
3. 状态变更需要权限验证 