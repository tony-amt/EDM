# SPEC-005 å‰ç«¯æ„å»ºæ–‡ä»¶å‘½åè§„èŒƒ

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è§„å®šäº†EDMç³»ç»Ÿå‰ç«¯æ„å»ºæ–‡ä»¶çš„å‘½åè§„èŒƒï¼Œç¡®ä¿æ–‡ä»¶ç‰ˆæœ¬ç®¡ç†çš„ä¸€è‡´æ€§å’Œå¯ç»´æŠ¤æ€§ã€‚

## ğŸ—ï¸ å½“å‰æ„å»ºé…ç½®

### Webpacké…ç½®
- ä½¿ç”¨ `react-scripts` é»˜è®¤é…ç½®
- ç”Ÿäº§ç¯å¢ƒæ–‡ä»¶å‘½åè§„åˆ™ï¼š`[name].[contenthash:8].[ext]`
- å¼€å‘ç¯å¢ƒæ–‡ä»¶å‘½åè§„åˆ™ï¼š`bundle.js`

### æ–‡ä»¶ç±»å‹å‘½åè§„èŒƒ

| æ–‡ä»¶ç±»å‹ | å‘½åè§„åˆ™ | ç¤ºä¾‹ | è¯´æ˜ |
|---------|---------|------|------|
| ä¸»JSæ–‡ä»¶ | `main.[contenthash:8].js` | `main.49954b55.js` | åº”ç”¨ä¸»å…¥å£æ–‡ä»¶ |
| ä»£ç åˆ†å‰²æ–‡ä»¶ | `[name].[contenthash:8].chunk.js` | `vendors.a1b2c3d4.chunk.js` | å¼‚æ­¥åŠ è½½çš„ä»£ç å— |
| CSSæ–‡ä»¶ | `main.[contenthash:8].css` | `main.f8e7d6c5.css` | æ ·å¼æ–‡ä»¶ |
| é™æ€èµ„æº | `[name].[hash].[ext]` | `logo.b4a3c2d1.png` | å›¾ç‰‡ã€å­—ä½“ç­‰èµ„æº |
| Source Map | `[filename].map` | `main.49954b55.js.map` | è°ƒè¯•æ˜ å°„æ–‡ä»¶ |

## ğŸ” å“ˆå¸Œå€¼è¯´æ˜

### contenthashï¼ˆå†…å®¹å“ˆå¸Œï¼‰
- **ç”Ÿæˆè§„åˆ™**ï¼šåŸºäºæ–‡ä»¶å†…å®¹çš„MD5å“ˆå¸Œå€¼å‰8ä½
- **å˜æ›´è§¦å‘**ï¼šåªæœ‰æ–‡ä»¶å†…å®¹æ”¹å˜æ—¶æ‰ä¼šå˜æ›´
- **ç¼“å­˜ä¼˜åŠ¿**ï¼šæœªå˜æ›´çš„æ–‡ä»¶ä¿æŒç›¸åŒå“ˆå¸Œï¼Œåˆ©ç”¨æµè§ˆå™¨ç¼“å­˜

### å“ˆå¸Œå€¼ç¤ºä¾‹åˆ†æ
```bash
# å½“å‰æ„å»ºæ–‡ä»¶
main.49954b55.js          # 8ä½å†…å®¹å“ˆå¸Œ
main.49954b55.js.map      # å¯¹åº”çš„source map

# ä»£ç æ›´æ–°åå¯èƒ½å˜ä¸º
main.a1b2c3d4.js          # æ–°çš„8ä½å†…å®¹å“ˆå¸Œ
main.a1b2c3d4.js.map      # å¯¹åº”çš„source map
```

## ğŸ“ æ–‡ä»¶ç»“æ„è§„èŒƒ

### æ„å»ºè¾“å‡ºç›®å½•ç»“æ„
```
build/
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”œâ”€â”€ main.[contenthash:8].css
â”‚   â”‚   â””â”€â”€ main.[contenthash:8].css.map
â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”œâ”€â”€ main.[contenthash:8].js
â”‚   â”‚   â”œâ”€â”€ main.[contenthash:8].js.map
â”‚   â”‚   â””â”€â”€ [chunk].[contenthash:8].chunk.js
â”‚   â””â”€â”€ media/
â”‚       â””â”€â”€ [name].[hash].[ext]
â”œâ”€â”€ index.html
â””â”€â”€ manifest.json
```

## ğŸ”„ ç‰ˆæœ¬ç®¡ç†ç­–ç•¥

### è‡ªåŠ¨ç‰ˆæœ¬æ§åˆ¶
1. **æ„å»ºæ—¶è‡ªåŠ¨ç”Ÿæˆ**ï¼šæ¯æ¬¡ `npm run build` è‡ªåŠ¨ç”Ÿæˆæ–°å“ˆå¸Œ
2. **å†…å®¹é©±åŠ¨æ›´æ–°**ï¼šåªæœ‰ä»£ç å˜æ›´æ‰ä¼šäº§ç”Ÿæ–°æ–‡ä»¶å
3. **ç¼“å­˜å‹å¥½**ï¼šæœªå˜æ›´æ–‡ä»¶ä¿æŒåŸæœ‰æ–‡ä»¶åå’Œç¼“å­˜

### éƒ¨ç½²æ–‡ä»¶è·Ÿè¸ª
```bash
# éƒ¨ç½²å‰è®°å½•å½“å‰æ–‡ä»¶
ls -la build/static/js/main.*.js

# éƒ¨ç½²åéªŒè¯
curl -I https://tkmail.fun/static/js/main.[hash].js
```

## ğŸ› ï¸ ç»´æŠ¤å»ºè®®

### æ„å»ºæ–‡ä»¶æ¸…ç†
```bash
# æ¸…ç†æ—§çš„æ„å»ºæ–‡ä»¶
rm -rf src/frontend/build/

# é‡æ–°æ„å»º
cd src/frontend && npm run build
```

### æ–‡ä»¶åå˜æ›´æ£€æŸ¥
```bash
# æ£€æŸ¥æ„å»ºå‰åæ–‡ä»¶åå˜åŒ–
diff <(ls build/static/js/) <(ls build.old/static/js/)
```

## ğŸš¨ æ³¨æ„äº‹é¡¹

### ä¸è¦æ‰‹åŠ¨ä¿®æ”¹æ–‡ä»¶å
- âŒ ä¸è¦æ‰‹åŠ¨é‡å‘½åæ„å»ºæ–‡ä»¶
- âŒ ä¸è¦åˆ é™¤å“ˆå¸Œå€¼
- âœ… ä¾èµ–webpackè‡ªåŠ¨ç”Ÿæˆ

### éƒ¨ç½²éªŒè¯æ¸…å•
- [ ] æ£€æŸ¥æ–°æ–‡ä»¶æ˜¯å¦æ­£ç¡®ç”Ÿæˆ
- [ ] éªŒè¯index.htmlä¸­çš„æ–‡ä»¶å¼•ç”¨æ˜¯å¦æ›´æ–°
- [ ] ç¡®è®¤æœåŠ¡å™¨ä¸Šçš„æ—§æ–‡ä»¶å¯ä»¥å®‰å…¨åˆ é™¤
- [ ] æµ‹è¯•é¡µé¢æ˜¯å¦æ­£å¸¸åŠ è½½

## ğŸ“Š æ–‡ä»¶å¤§å°ç›‘æ§

### å»ºè®®æ–‡ä»¶å¤§å°èŒƒå›´
- ä¸»JSæ–‡ä»¶ï¼š< 2MBï¼ˆå½“å‰ï¼š2.3MBï¼Œéœ€è¦ä¼˜åŒ–ï¼‰
- CSSæ–‡ä»¶ï¼š< 500KB
- ä»£ç åˆ†å‰²å—ï¼š< 1MB

### ä¼˜åŒ–å»ºè®®
1. **ä»£ç åˆ†å‰²**ï¼šä½¿ç”¨React.lazy()è¿›è¡Œè·¯ç”±çº§åˆ«åˆ†å‰²
2. **ä¾èµ–åˆ†æ**ï¼šä½¿ç”¨webpack-bundle-analyzeråˆ†æåŒ…å¤§å°
3. **Tree Shaking**ï¼šç§»é™¤æœªä½¿ç”¨çš„ä»£ç 

## ğŸ”— ç›¸å…³æ–‡æ¡£
- [SPEC-001 é…ç½®ç®¡ç†è§„èŒƒ](./SPEC-001-é…ç½®ç®¡ç†è§„èŒƒ.md)
- [éƒ¨ç½²æŒ‡å—](../standards/deployment/deployment-guide.md)

---
**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2025-01-13  
**æœ€åæ›´æ–°**ï¼š2025-01-13 