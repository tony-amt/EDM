# SPEC-010: AIåä½œè§„èŒƒå¼ºåˆ¶æ‰§è¡Œæœºåˆ¶

## ğŸ“‹ æ–‡æ¡£ä¿¡æ¯
- **æ–‡æ¡£ç¼–å·**: SPEC-010
- **åˆ›å»ºæ—¥æœŸ**: 2025-01-20
- **æœ€åæ›´æ–°**: 2025-01-20
- **ç‰ˆæœ¬**: v1.0
- **çŠ¶æ€**: ç”Ÿæ•ˆä¸­

## ğŸ¯ ç›®æ ‡ä¸åŸåˆ™

### æ ¸å¿ƒç›®æ ‡
è®©ç”¨æˆ·**ä¸“æ³¨ä¸šåŠ¡æ€è€ƒ**ï¼ŒAI**è‡ªåŠ¨å¤„ç†æŠ€æœ¯è§„èŒƒ**ï¼Œå®ç°é›¶äººå·¥å¹²é¢„çš„å¼€å‘æµç¨‹ã€‚

### æ‰§è¡ŒåŸåˆ™
1. **è‡ªåŠ¨ä¼˜å…ˆ**: èƒ½è‡ªåŠ¨åŒ–çš„ç»ä¸æ‰‹å·¥æ“ä½œ
2. **é›¶å¹²æ‰°**: ä¸æ‰“æ–­ç”¨æˆ·çš„ä¸šåŠ¡æ€è€ƒ
3. **æ™ºèƒ½ä¿®æ­£**: å‘ç°é—®é¢˜è‡ªåŠ¨ä¿®å¤
4. **æŒç»­éªŒè¯**: å®æ—¶æ£€æŸ¥ä»£ç è´¨é‡

## ğŸ”§ æŠ€æœ¯å®ç°æ¶æ„

### 1. Cursorè§„åˆ™è‡ªåŠ¨è§¦å‘ç³»ç»Ÿ

#### 1.1 è§„åˆ™é…ç½®çŸ©é˜µ
```
.cursor/rules/
â”œâ”€â”€ edm-auto-validator.mdc     # Always - è‡ªåŠ¨éªŒè¯è§„åˆ™
â”œâ”€â”€ edm-business-focus.mdc     # Agent Requested - ä¸šåŠ¡ä¸“æ³¨è§„åˆ™
â”œâ”€â”€ edm-frontend.mdc           # Auto Attached - å‰ç«¯æ–‡ä»¶è§¦å‘
â”œâ”€â”€ edm-backend.mdc            # Auto Attached - åç«¯æ–‡ä»¶è§¦å‘
â””â”€â”€ edm-core.mdc               # Always - æ ¸å¿ƒé¡¹ç›®ä¿¡æ¯
```

#### 1.2 è§¦å‘æœºåˆ¶
- **Alwaysè§„åˆ™**: æ¯æ¬¡å¯¹è¯è‡ªåŠ¨åŠ è½½
- **Auto Attachedè§„åˆ™**: æ ¹æ®æ–‡ä»¶ç±»å‹è‡ªåŠ¨è§¦å‘
- **Agent Requestedè§„åˆ™**: AIæ ¹æ®åœºæ™¯åˆ¤æ–­åŠ è½½

#### 1.3 è‡ªåŠ¨æ‰§è¡Œæµç¨‹
```mermaid
graph TD
    A[ç”¨æˆ·è¾“å…¥] --> B[AIç†è§£éœ€æ±‚]
    B --> C[ç”Ÿæˆä»£ç ]
    C --> D[è‡ªåŠ¨è¿è¡ŒéªŒè¯è„šæœ¬]
    D --> E{éªŒè¯é€šè¿‡?}
    E -->|å¦| F[è‡ªåŠ¨ä¿®æ­£é—®é¢˜]
    F --> D
    E -->|æ˜¯| G[å‘ç”¨æˆ·åé¦ˆç»“æœ]
```

### 2. è„šæœ¬è‡ªåŠ¨åŒ–ç³»ç»Ÿ

#### 2.1 æ ¸å¿ƒè„šæœ¬
- `scripts/ai-auto-fix.sh` - è‡ªåŠ¨ä¿®æ­£è„šæœ¬
- `scripts/ai-code-validator.sh` - éªŒè¯è„šæœ¬
- `scripts/auto-dev-mode.sh` - ä¸€é”®å¯åŠ¨è„šæœ¬

#### 2.2 è‡ªåŠ¨ä¿®æ­£èƒ½åŠ›
```bash
# æ–‡ä»¶å‘½åè‡ªåŠ¨ä¿®æ­£
QuotaService.js â†’ quota.service.js
EmailConversation.js â†’ emailConversation.model.js

# APIè·¯å¾„è‡ªåŠ¨ä¿®æ­£
app.use('/users', routes) â†’ app.use('/api/users', routes)

# é”™è¯¯å¤„ç†è‡ªåŠ¨æ·»åŠ 
function â†’ async function with try-catch
```

#### 2.3 éªŒè¯æ£€æŸ¥é¡¹ç›®
- âœ… æ–‡ä»¶å‘½åè§„èŒƒ (45é¡¹æ£€æŸ¥)
- âœ… APIæ¥å£è§„èŒƒ
- âœ… é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… å®‰å…¨æ€§æ£€æŸ¥
- âœ… TypeScriptç±»å‹
- âœ… æµ‹è¯•è¦†ç›–ç‡

### 3. Git Hooksè‡ªåŠ¨åŒ–

#### 3.1 Pre-commitæµç¨‹
```bash
#!/usr/bin/env sh
# .husky/pre-commit

# 1. è‡ªåŠ¨ä¿®æ­£é—®é¢˜
./scripts/ai-auto-fix.sh

# 2. éªŒè¯é¡¹ç›®è§„èŒƒ
./scripts/ai-code-validator.sh

# 3. ä»£ç è´¨é‡æ£€æŸ¥
npm run lint:fix

# 4. ç±»å‹æ£€æŸ¥
npm run type-check
```

#### 3.2 Commit-msgéªŒè¯
```bash
#!/usr/bin/env sh
# .husky/commit-msg

# éªŒè¯æäº¤ä¿¡æ¯æ ¼å¼
npx --no -- commitlint --edit ${1}
```

### 4. VS Codeä»»åŠ¡è‡ªåŠ¨åŒ–

#### 4.1 è‡ªåŠ¨ä»»åŠ¡é…ç½®
```json
{
    "tasks": [
        {
            "label": "ğŸš€ EDM: è‡ªåŠ¨ä¿®æ­£ + éªŒè¯",
            "runOptions": { "runOn": "folderOpen" }
        }
    ]
}
```

#### 4.2 å¿«æ·æ“ä½œ
- `Ctrl+Shift+P` â†’ "Tasks: Run Task"
- è‡ªåŠ¨åœ¨é¡¹ç›®æ‰“å¼€æ—¶è¿è¡ŒéªŒè¯

## ğŸ¯ ä¸šåŠ¡åœºæ™¯è‡ªåŠ¨åŒ–

### 1. éœ€æ±‚ç†è§£æ¨¡æ¿

#### ç”¨æˆ·è¾“å…¥åˆ†æ
```
ç”¨æˆ·: "éœ€è¦ä¸€ä¸ªé‚®ä»¶å‘é€çŠ¶æ€ç›‘æ§åŠŸèƒ½"

AIè‡ªåŠ¨å¤„ç†:
1. ä¸šåŠ¡åˆ†æ â†’ é‚®ä»¶çŠ¶æ€è·Ÿè¸ªéœ€æ±‚
2. æ•°æ®è®¾è®¡ â†’ email_statusè¡¨ç»“æ„
3. æ¥å£è®¾è®¡ â†’ /api/email/statusè·¯å¾„
4. å‰ç«¯è®¾è®¡ â†’ EmailStatusMonitorç»„ä»¶
5. è‡ªåŠ¨éªŒè¯ â†’ è¿è¡Œè§„èŒƒæ£€æŸ¥
6. ç»“æœåé¦ˆ â†’ "âœ… åŠŸèƒ½å·²å®ç°å¹¶éªŒè¯é€šè¿‡"
```

### 2. è‡ªåŠ¨åŒ–æŠ€æœ¯å®ç°

#### 2.1 æ•°æ®åº“è®¾è®¡è‡ªåŠ¨åŒ–
```sql
-- ç”¨æˆ·è¯´: "éœ€è¦è®°å½•é‚®ä»¶æ‰“å¼€æ¬¡æ•°"
-- AIè‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–è¡¨ç»“æ„:
CREATE TABLE email_open_logs (
    id SERIAL PRIMARY KEY,
    email_id INTEGER REFERENCES emails(id),
    contact_id INTEGER REFERENCES contacts(id),
    opened_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    ip_address INET,
    user_agent TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### 2.2 APIæ¥å£è‡ªåŠ¨åŒ–
```javascript
// è‡ªåŠ¨ç”Ÿæˆæ ‡å‡†åŒ–æ§åˆ¶å™¨
exports.getEmailOpenStats = async (req, res, next) => {
    try {
        const { emailId } = req.params;
        
        // è¾“å…¥éªŒè¯
        if (!emailId || isNaN(emailId)) {
            return res.status(400).json({
                success: false,
                message: 'æ— æ•ˆçš„é‚®ä»¶ID'
            });
        }
        
        const stats = await EmailService.getOpenStats(emailId);
        
        res.json({
            success: true,
            data: stats,
            timestamp: new Date().toISOString()
        });
    } catch (error) {
        next(error);
    }
};
```

#### 2.3 å‰ç«¯ç»„ä»¶è‡ªåŠ¨åŒ–
```typescript
// è‡ªåŠ¨ç”ŸæˆTypeScriptç»„ä»¶
interface EmailStatsProps {
    emailId: string;
}

interface EmailStats {
    openCount: number;
    openRate: number;
    openData: Array<{
        date: string;
        count: number;
    }>;
}

const EmailOpenChart: React.FC<EmailStatsProps> = ({ emailId }) => {
    const [stats, setStats] = useState<EmailStats | null>(null);
    const [loading, setLoading] = useState(true);
    const [error, setError] = useState<string | null>(null);
    
    useEffect(() => {
        const fetchStats = async () => {
            try {
                setLoading(true);
                const response = await emailService.getOpenStats(emailId);
                setStats(response.data);
            } catch (err) {
                setError(err instanceof Error ? err.message : 'è·å–æ•°æ®å¤±è´¥');
            } finally {
                setLoading(false);
            }
        };
        
        if (emailId) {
            fetchStats();
        }
    }, [emailId]);
    
    if (loading) return <Spin size="large" />;
    if (error) return <Alert message={error} type="error" />;
    if (!stats) return <Empty description="æš‚æ— æ•°æ®" />;
    
    return (
        <Card title="é‚®ä»¶æ‰“å¼€ç»Ÿè®¡" className="email-stats-card">
            <LineChart data={stats.openData} />
            <div className="stats-summary">
                <Statistic title="æ€»æ‰“å¼€æ¬¡æ•°" value={stats.openCount} />
                <Statistic title="æ‰“å¼€ç‡" value={stats.openRate} suffix="%" />
            </div>
        </Card>
    );
};

export default EmailOpenChart;
```

## ğŸš« ç¦æ­¢è¯¢é—®æ¸…å•

### AIä¸åº”è¯¥è¯¢é—®çš„æŠ€æœ¯ç»†èŠ‚
- âŒ "æ‚¨å¸Œæœ›ä½¿ç”¨ä»€ä¹ˆæ•°æ®åº“å­—æ®µç±»å‹ï¼Ÿ"
- âŒ "APIæ¥å£è·¯å¾„æ‚¨è§‰å¾—æ€ä¹ˆå‘½åï¼Ÿ"
- âŒ "å‰ç«¯ç»„ä»¶æ”¾åœ¨å“ªä¸ªç›®å½•ï¼Ÿ"
- âŒ "æ˜¯å¦éœ€è¦æ·»åŠ é”™è¯¯å¤„ç†ï¼Ÿ"
- âŒ "æµ‹è¯•ç”¨ä¾‹è¦æ€ä¹ˆå†™ï¼Ÿ"
- âŒ "éœ€è¦ä»€ä¹ˆæ ·çš„éªŒè¯è§„åˆ™ï¼Ÿ"

### AIåº”è¯¥è‡ªåŠ¨å¤„ç†çš„äº‹é¡¹
- âœ… æ ¹æ®é¡¹ç›®è§„èŒƒè‡ªåŠ¨é€‰æ‹©æ•°æ®ç±»å‹
- âœ… è‡ªåŠ¨ä½¿ç”¨RESTful APIå‘½åè§„èŒƒ
- âœ… è‡ªåŠ¨æŒ‰ç›®å½•ç»“æ„æ”¾ç½®æ–‡ä»¶
- âœ… è‡ªåŠ¨æ·»åŠ é”™è¯¯å¤„ç†å’ŒéªŒè¯
- âœ… è‡ªåŠ¨ç”ŸæˆåŸºç¡€æµ‹è¯•ç”¨ä¾‹
- âœ… è‡ªåŠ¨è¿è¡Œè§„èŒƒéªŒè¯è„šæœ¬

## ğŸ“Š æ‰§è¡Œæ•ˆæœç›‘æ§

### 1. è‡ªåŠ¨åŒ–æŒ‡æ ‡

#### å…³é”®æŒ‡æ ‡
- **è‡ªåŠ¨ä¿®æ­£ç‡**: 95%+ çš„é—®é¢˜è‡ªåŠ¨ä¿®å¤
- **è§„èŒƒé€šè¿‡ç‡**: 100% ä»£ç ç¬¦åˆé¡¹ç›®è§„èŒƒ
- **ç”¨æˆ·å¹²é¢„ç‡**: < 5% éœ€è¦ç”¨æˆ·æ‰‹åŠ¨å¤„ç†
- **å¼€å‘æ•ˆç‡**: æŠ€æœ¯å®ç°æ—¶é—´å‡å°‘ 80%

#### ç›‘æ§æ–¹å¼
```bash
# æ¯æ—¥è‡ªåŠ¨åŒ–æŠ¥å‘Š
./scripts/automation-report.sh

# è¾“å‡ºç¤ºä¾‹:
# ğŸ“Š EDMè‡ªåŠ¨åŒ–æ—¥æŠ¥ - 2025-01-20
# âœ… è‡ªåŠ¨ä¿®æ­£: 23ä¸ªé—®é¢˜
# âœ… è§„èŒƒéªŒè¯: 100%é€šè¿‡
# âœ… ç”¨æˆ·ä¸“æ³¨åº¦: 95%ä¸šåŠ¡æ—¶é—´
# ğŸ¯ å»ºè®®: ç»§ç»­ä¿æŒå½“å‰è‡ªåŠ¨åŒ–æ°´å¹³
```

### 2. è´¨é‡ä¿è¯

#### ä»£ç è´¨é‡è‡ªåŠ¨æ£€æŸ¥
- ESLintè§„åˆ™: 0é”™è¯¯0è­¦å‘Š
- TypeScript: ä¸¥æ ¼ç±»å‹æ£€æŸ¥
- æµ‹è¯•è¦†ç›–ç‡: â‰¥80%
- å®‰å…¨æ‰«æ: æ— é«˜å±æ¼æ´

#### æ€§èƒ½è‡ªåŠ¨ä¼˜åŒ–
- APIå“åº”æ—¶é—´: <500ms
- å‰ç«¯åŠ è½½æ—¶é—´: <3s
- æ•°æ®åº“æŸ¥è¯¢: è‡ªåŠ¨ç´¢å¼•ä¼˜åŒ–
- å†…å­˜ä½¿ç”¨: è‡ªåŠ¨åƒåœ¾å›æ”¶

## ğŸ”„ æŒç»­æ”¹è¿›æœºåˆ¶

### 1. è§„åˆ™è‡ªåŠ¨æ›´æ–°

#### æ›´æ–°è§¦å‘æ¡ä»¶
- å‘ç°æ–°çš„å¸¸è§é—®é¢˜æ¨¡å¼
- é¡¹ç›®è§„èŒƒå˜æ›´
- æŠ€æœ¯æ ˆå‡çº§
- å›¢é˜Ÿåé¦ˆ

#### æ›´æ–°æµç¨‹
```bash
# 1. åˆ†æé—®é¢˜æ¨¡å¼
./scripts/analyze-patterns.sh

# 2. ç”Ÿæˆæ–°è§„åˆ™
./scripts/generate-rules.sh

# 3. æµ‹è¯•è§„åˆ™æ•ˆæœ
./scripts/test-rules.sh

# 4. éƒ¨ç½²è§„åˆ™æ›´æ–°
./scripts/deploy-rules.sh
```

### 2. æ™ºèƒ½å­¦ä¹ æœºåˆ¶

#### å­¦ä¹ å†…å®¹
- ç”¨æˆ·ä¸šåŠ¡éœ€æ±‚æ¨¡å¼
- å¸¸è§æŠ€æœ¯å®ç°æ–¹æ¡ˆ
- æœ€ä½³å®è·µæ¨¡æ¿
- é”™è¯¯å¤„ç†æ¨¡å¼

#### ä¼˜åŒ–æ–¹å‘
- æé«˜éœ€æ±‚ç†è§£å‡†ç¡®åº¦
- å‡å°‘è‡ªåŠ¨ä¿®æ­£æ¬¡æ•°
- ä¼˜åŒ–ä»£ç ç”Ÿæˆè´¨é‡
- å¢å¼ºé”™è¯¯é¢„é˜²èƒ½åŠ›

## ğŸ¯ æˆåŠŸæ ‡å‡†

### ç”¨æˆ·ä½“éªŒç›®æ ‡
- ç”¨æˆ·åªéœ€æè¿°ä¸šåŠ¡éœ€æ±‚
- AIè‡ªåŠ¨ç†è§£å¹¶å®Œæ•´å®ç°
- ä»£ç ç«‹å³å¯ç”¨å¯æµ‹è¯•
- é›¶æŠ€æœ¯ç»†èŠ‚å¹²æ‰°

### æŠ€æœ¯è´¨é‡ç›®æ ‡
- 100% ç¬¦åˆé¡¹ç›®è§„èŒƒ
- 95%+ è‡ªåŠ¨åŒ–å¤„ç†ç‡
- 0 æ‰‹åŠ¨ä¿®æ­£éœ€æ±‚
- 80%+ å¼€å‘æ•ˆç‡æå‡

## ğŸ“‹ å®æ–½æ£€æŸ¥æ¸…å•

### ç¯å¢ƒé…ç½®æ£€æŸ¥
- [ ] Cursorè§„åˆ™æ–‡ä»¶å·²åˆ›å»º
- [ ] è‡ªåŠ¨åŒ–è„šæœ¬å·²éƒ¨ç½²
- [ ] Git Hookså·²é…ç½®
- [ ] VS Codeä»»åŠ¡å·²è®¾ç½®
- [ ] æ–‡ä»¶ç›‘æ§å·²å¯åŠ¨

### åŠŸèƒ½éªŒè¯æ£€æŸ¥
- [ ] è‡ªåŠ¨ä¿®æ­£åŠŸèƒ½æ­£å¸¸
- [ ] è§„èŒƒéªŒè¯åŠŸèƒ½æ­£å¸¸
- [ ] Gitæäº¤è‡ªåŠ¨æ£€æŸ¥
- [ ] ä¸šåŠ¡éœ€æ±‚è‡ªåŠ¨å®ç°
- [ ] é”™è¯¯è‡ªåŠ¨ä¿®å¤

### æ•ˆæœè¯„ä¼°æ£€æŸ¥
- [ ] ç”¨æˆ·ä¸“æ³¨åº¦æå‡
- [ ] å¼€å‘æ•ˆç‡æå‡
- [ ] ä»£ç è´¨é‡æå‡
- [ ] è§„èŒƒéµå®ˆç‡100%
- [ ] è‡ªåŠ¨åŒ–è¦†ç›–ç‡95%+

---

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬è§„èŒƒçš„å®æ–½ï¼ŒEDMé¡¹ç›®å®ç°äº†ï¼š

1. **å®Œå…¨è‡ªåŠ¨åŒ–çš„æŠ€æœ¯è§„èŒƒæ‰§è¡Œ**
2. **ç”¨æˆ·ä¸“æ³¨ä¸šåŠ¡ï¼ŒAIå¤„ç†æŠ€æœ¯**
3. **é›¶äººå·¥å¹²é¢„çš„ä»£ç è´¨é‡ä¿è¯**
4. **æŒç»­æ”¹è¿›çš„æ™ºèƒ½åŒ–å¼€å‘æµç¨‹**

è¿™å¥—æœºåˆ¶ç¡®ä¿äº†é¡¹ç›®çš„æŠ€æœ¯è´¨é‡ï¼ŒåŒæ—¶è®©ç”¨æˆ·èƒ½å¤Ÿä¸“æ³¨äºæœ€é‡è¦çš„ä¸šåŠ¡åˆ›æ–°å·¥ä½œã€‚ 