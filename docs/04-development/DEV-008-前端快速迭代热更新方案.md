# 前端快速迭代热更新方案

## 🎯 方案概述

本方案提供了一套完整的前端快速开发和部署流程，支持开发环境热更新和生产环境快速部署。

## 🔧 开发环境热更新

### 1. 容器化开发环境

```bash
# 构建开发镜像
cd src/frontend
docker build -f Dockerfile.dev -t edm-frontend:dev .

# 启动开发容器（支持热更新）
docker run -d \
  --name edm-frontend-debug \
  --network edm_edm-debug-network \
  -p 3003:3001 \
  -v "$(pwd)/src/frontend/src:/app/src" \
  -v "$(pwd)/src/frontend/public:/app/public" \
  edm-frontend:dev
```

### 2. 热更新机制

- **文件监听**: 通过Docker Volume挂载实现实时文件同步
- **自动重载**: React开发服务器自动检测文件变化并重新编译
- **实时预览**: 浏览器自动刷新显示最新更改

## 🚀 生产环境快速部署

### 1. 构建生产镜像

```bash
# 构建生产镜像（支持多架构）
cd src/frontend
docker build -f Dockerfile.prod -t edm-frontend:v1.x --platform linux/amd64 .
```

### 2. 镜像传输与部署

```bash
# 保存镜像
docker save edm-frontend:v1.x | gzip > edm-frontend-v1.x.tar.gz

# 上传到生产服务器
scp edm-frontend-v1.x.tar.gz ubuntu@43.135.38.15:~/

# 生产服务器加载镜像
ssh ubuntu@43.135.38.15 "gunzip -c ~/edm-frontend-v1.x.tar.gz | docker load"

# 更新生产容器
ssh ubuntu@43.135.38.15 "
  docker stop edm-frontend-prod && docker rm edm-frontend-prod
  docker run -d --name edm-frontend-prod --network edm_edm-network -p 3001:80 edm-frontend:v1.x
"
```

## 📋 常用命令

### 开发环境

```bash
# 启动开发环境
npm run dev

# 查看开发容器日志
docker logs -f edm-frontend-debug

# 重启开发容器
docker restart edm-frontend-debug
```

### 生产环境

```bash
# 快速部署新版本
./scripts/deploy-frontend.sh

# 查看生产容器状态
docker ps | grep edm-frontend-prod

# 验证部署结果
curl -I https://tkmail.fun
```

## 🐛 问题排查

### 1. 热更新不生效

**问题**: 修改代码后页面不自动刷新

**解决方案**:
```bash
# 检查Volume挂载
docker inspect edm-frontend-debug | grep Mounts -A 20

# 重启开发容器
docker restart edm-frontend-debug
```

### 2. 生产环境404错误

**问题**: 页面刷新后出现404错误

**解决方案**:
```bash
# 检查nginx配置
docker exec edm-frontend-prod cat /etc/nginx/conf.d/default.conf

# 重新加载nginx
docker exec edm-frontend-prod nginx -s reload
```

---

## 📝 变更记录

- 2025-06-26: 创建文档，包含热更新和快速部署方案
- 2025-06-26: 修复生产环境404问题，更新nginx配置
